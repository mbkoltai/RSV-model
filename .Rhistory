tm<-proc.time();
ode_solution<-lsoda(initvals_sirs_model,timesteps,func=sirs_seasonal_forc_mat_immun,parms=params);round(proc.time()-tm,2)
df_cases_infs <- fcn_process_odesol_incid(ode_solution,n_age,n_inf,n_compartment,simul_start_end)
# simple lineplot
sel_weeks <- df_cases_infs %>% mutate(week=week(date),year=year(date)) %>% filter(week %in% c(42,52,10)) %>%
group_by(year,agegroup,week) %>% filter(date==min(date) & infection==1)
p<-fcn_plot_timecourse_by_agegr(df_cases_infs %>%
filter(t %% 7==0 & agegroup<=9 & date>as.Date("2015-10-01") & date<as.Date("2022-03-01")),
agegroup_name=rsv_age_groups$agegroup_name,sel_agelim=9,varname="value",npidates=npi_dates,date_break_val="2 month",
selweeks=sel_weeks,alphaval=0.01,vline_w=c(1/4,1/8)); p+theme(legend.position="top")
View(df_cases_infs %>% filter(date>as.Date("2018-10-15") & date<as.Date("2019-03-01")) %>% group_by(agegroup,infection) %>%
summarise(cumul_inf=sum(value)) %>% mutate(agegr_prop=round(100*cumul_inf/rsv_age_groups$value[agegroup],1)))
delta_primary <- (c(1,1,1)/2^c(-1,2,3))/80
agedep_fact=1; delta_susc=sapply(1:n_age, function(x) {delta_primary/((agedep_fact^(x-1)))})
simul_length_yr=10; post_npi_yr=3
l_seas<-fun_shutdown_seasforc(npi_dates,years_pre_post_npi=c(simul_length_yr-post_npi_yr,post_npi_yr),
season_width_wks=seasforc_width_wks,init_mt_day="06-01",peak_week=c(45,49)[1],
forcing_above_baseline=1/2, npireduc_strength=0.5)
g(n_years,timesteps,simul_start_end,forcing_vector_npi) %=% l_seas
approx_seas_forc <- approxfun(data.frame(t=timesteps,seas_force=forcing_vector_npi))
approx_introd <- approxfun(data.frame(t=timesteps,as.numeric(timesteps %% 30==0)*10))
###
params<-list(list(birth_rates,matrix(unlist(lapply(uk_death_rate,function(x) rep(x,n_inf*n_compartment))))),
K_m,contmatr_rowvector,inf_vars_inds,susc_vars_inds,delta_susc)
# maternal immunity?
if (mat_imm_flag){ params[[7]] <- mat_imm_inds}
# initial conditions
initvals_sirs_model <- fcn_set_initconds(rsv_age_groups$stationary_popul,
init_set=c("previous","fromscratch")[1],init_cond_src=c("output","file")[1],
ode_solution[1:(ncol(ode_solution)-1),],init_seed=10,seed_vars="all",filename="")
# SIMULATE
tm<-proc.time();
ode_solution<-lsoda(initvals_sirs_model,timesteps,func=sirs_seasonal_forc_mat_immun,parms=params);round(proc.time()-tm,2)
df_cases_infs <- fcn_process_odesol_incid(ode_solution,n_age,n_inf,n_compartment,simul_start_end)
# simple lineplot
sel_weeks <- df_cases_infs %>% mutate(week=week(date),year=year(date)) %>% filter(week %in% c(42,52,10)) %>%
group_by(year,agegroup,week) %>% filter(date==min(date) & infection==1)
p<-fcn_plot_timecourse_by_agegr(df_cases_infs %>%
filter(t %% 7==0 & agegroup<=9 & date>as.Date("2015-10-01") & date<as.Date("2022-03-01")),
agegroup_name=rsv_age_groups$agegroup_name,sel_agelim=9,varname="value",npidates=npi_dates,date_break_val="2 month",
selweeks=sel_weeks,alphaval=0.01,vline_w=c(1/4,1/8)); p+theme(legend.position="top")
p<-fcn_plot_timecourse_by_agegr(df_cases_infs %>%
filter(t %% 7==0 & agegroup<=9 & date>as.Date("2017-10-01") & date<as.Date("2022-03-01")),
agegroup_name=rsv_age_groups$agegroup_name,sel_agelim=9,varname="value",npidates=npi_dates,date_break_val="2 month",
selweeks=sel_weeks,alphaval=0.01,vline_w=c(1/4,1/8)); p+theme(legend.position="top")
View(df_cases_infs %>% filter(date>as.Date("2018-10-15") & date<as.Date("2019-03-01")) %>% group_by(agegroup,infection) %>%
summarise(cumul_inf=sum(value)) %>% mutate(agegr_prop=round(100*cumul_inf/rsv_age_groups$value[agegroup],1)))
delta_primary <- (c(1,1,1)/2^c(-1,2,4))/80
agedep_fact=1; delta_susc=sapply(1:n_age, function(x) {delta_primary/((agedep_fact^(x-1)))})
simul_length_yr=10; post_npi_yr=3
l_seas<-fun_shutdown_seasforc(npi_dates,years_pre_post_npi=c(simul_length_yr-post_npi_yr,post_npi_yr),
season_width_wks=seasforc_width_wks,init_mt_day="06-01",peak_week=c(45,49)[1],
forcing_above_baseline=1/2, npireduc_strength=0.5)
g(n_years,timesteps,simul_start_end,forcing_vector_npi) %=% l_seas
approx_seas_forc <- approxfun(data.frame(t=timesteps,seas_force=forcing_vector_npi))
approx_introd <- approxfun(data.frame(t=timesteps,as.numeric(timesteps %% 30==0)*10))
###
params<-list(list(birth_rates,matrix(unlist(lapply(uk_death_rate,function(x) rep(x,n_inf*n_compartment))))),
K_m,contmatr_rowvector,inf_vars_inds,susc_vars_inds,delta_susc)
# maternal immunity?
if (mat_imm_flag){ params[[7]] <- mat_imm_inds}
# initial conditions
initvals_sirs_model <- fcn_set_initconds(rsv_age_groups$stationary_popul,
init_set=c("previous","fromscratch")[1],init_cond_src=c("output","file")[1],
ode_solution[1:(ncol(ode_solution)-1),],init_seed=10,seed_vars="all",filename="")
# SIMULATE
tm<-proc.time();
ode_solution<-lsoda(initvals_sirs_model,timesteps,func=sirs_seasonal_forc_mat_immun,parms=params);round(proc.time()-tm,2)
df_cases_infs <- fcn_process_odesol_incid(ode_solution,n_age,n_inf,n_compartment,simul_start_end)
# simple lineplot
sel_weeks <- df_cases_infs %>% mutate(week=week(date),year=year(date)) %>% filter(week %in% c(42,52,10)) %>%
group_by(year,agegroup,week) %>% filter(date==min(date) & infection==1)
p<-fcn_plot_timecourse_by_agegr(df_cases_infs %>%
filter(t %% 7==0 & agegroup<=9 & date>as.Date("2017-10-01") & date<as.Date("2022-03-01")),
agegroup_name=rsv_age_groups$agegroup_name,sel_agelim=9,varname="value",npidates=npi_dates,date_break_val="2 month",
selweeks=sel_weeks,alphaval=0.01,vline_w=c(1/4,1/8)); p+theme(legend.position="top")
simul_length_yr=7; post_npi_yr=2
l_seas<-fun_shutdown_seasforc(npi_dates,years_pre_post_npi=c(simul_length_yr-post_npi_yr,post_npi_yr),
season_width_wks=seasforc_width_wks,init_mt_day="06-01",peak_week=c(45,49)[1],
forcing_above_baseline=1/2, npireduc_strength=0.5)
g(n_years,timesteps,simul_start_end,forcing_vector_npi) %=% l_seas
approx_seas_forc <- approxfun(data.frame(t=timesteps,seas_force=forcing_vector_npi))
approx_introd <- approxfun(data.frame(t=timesteps,as.numeric(timesteps %% 30==0)*10))
###
params<-list(list(birth_rates,matrix(unlist(lapply(uk_death_rate,function(x) rep(x,n_inf*n_compartment))))),
K_m,contmatr_rowvector,inf_vars_inds,susc_vars_inds,delta_susc)
# maternal immunity?
if (mat_imm_flag){ params[[7]] <- mat_imm_inds}
# initial conditions
initvals_sirs_model <- fcn_set_initconds(rsv_age_groups$stationary_popul,
init_set=c("previous","fromscratch")[1],init_cond_src=c("output","file")[1],
ode_solution[1:(ncol(ode_solution)-1),],init_seed=10,seed_vars="all",filename="")
# SIMULATE
tm<-proc.time();
ode_solution<-lsoda(initvals_sirs_model,timesteps,func=sirs_seasonal_forc_mat_immun,parms=params);round(proc.time()-tm,2)
df_cases_infs <- fcn_process_odesol_incid(ode_solution,n_age,n_inf,n_compartment,simul_start_end)
# simple lineplot
sel_weeks <- df_cases_infs %>% mutate(week=week(date),year=year(date)) %>% filter(week %in% c(42,52,10)) %>%
group_by(year,agegroup,week) %>% filter(date==min(date) & infection==1)
p<-fcn_plot_timecourse_by_agegr(df_cases_infs %>%
filter(t %% 7==0 & agegroup<=9 & date>as.Date("2017-10-01") & date<as.Date("2022-03-01")),
agegroup_name=rsv_age_groups$agegroup_name,sel_agelim=9,varname="value",npidates=npi_dates,date_break_val="2 month",
selweeks=sel_weeks,alphaval=0.01,vline_w=c(1/4,1/8)); p+theme(legend.position="top")
sel_weeks <- df_cases_infs %>% mutate(week=week(date),year=year(date)) %>% filter(week %in% c(42,52,10)) %>%
group_by(year,agegroup,week) %>% filter(date==min(date) & infection==1)
p<-fcn_plot_timecourse_by_agegr(df_cases_infs %>%
filter(t %% 7==0 & agegroup<=9 & date>as.Date("2016-10-01") & date<as.Date("2022-03-01")),
agegroup_name=rsv_age_groups$agegroup_name,sel_agelim=9,varname="value",npidates=npi_dates,date_break_val="2 month",
selweeks=sel_weeks,alphaval=0.01,vline_w=c(1/4,1/8)); p+theme(legend.position="top")
delta_primary <- (c(1,1,1)/2^c(-1,2,4))/60
agedep_fact=1; delta_susc=sapply(1:n_age, function(x) {delta_primary/((agedep_fact^(x-1)))})
simul_length_yr=7; post_npi_yr=2
l_seas<-fun_shutdown_seasforc(npi_dates,years_pre_post_npi=c(simul_length_yr-post_npi_yr,post_npi_yr),
season_width_wks=seasforc_width_wks,init_mt_day="06-01",peak_week=c(45,49)[1],
forcing_above_baseline=1/2, npireduc_strength=0.5)
g(n_years,timesteps,simul_start_end,forcing_vector_npi) %=% l_seas
approx_seas_forc <- approxfun(data.frame(t=timesteps,seas_force=forcing_vector_npi))
approx_introd <- approxfun(data.frame(t=timesteps,as.numeric(timesteps %% 30==0)*10))
###
params<-list(list(birth_rates,matrix(unlist(lapply(uk_death_rate,function(x) rep(x,n_inf*n_compartment))))),
K_m,contmatr_rowvector,inf_vars_inds,susc_vars_inds,delta_susc)
# maternal immunity?
if (mat_imm_flag){ params[[7]] <- mat_imm_inds}
# initial conditions
initvals_sirs_model <- fcn_set_initconds(rsv_age_groups$stationary_popul,
init_set=c("previous","fromscratch")[1],init_cond_src=c("output","file")[1],
ode_solution[1:(ncol(ode_solution)-1),],init_seed=10,seed_vars="all",filename="")
# SIMULATE
tm<-proc.time();
ode_solution<-lsoda(initvals_sirs_model,timesteps,func=sirs_seasonal_forc_mat_immun,parms=params);round(proc.time()-tm,2)
df_cases_infs <- fcn_process_odesol_incid(ode_solution,n_age,n_inf,n_compartment,simul_start_end)
# simple lineplot
sel_weeks <- df_cases_infs %>% mutate(week=week(date),year=year(date)) %>% filter(week %in% c(42,52,10)) %>%
group_by(year,agegroup,week) %>% filter(date==min(date) & infection==1)
p<-fcn_plot_timecourse_by_agegr(df_cases_infs %>%
filter(t %% 7==0 & agegroup<=9 & date>as.Date("2016-10-01") & date<as.Date("2022-03-01")),
agegroup_name=rsv_age_groups$agegroup_name,sel_agelim=9,varname="value",npidates=npi_dates,date_break_val="2 month",
selweeks=sel_weeks,alphaval=0.01,vline_w=c(1/4,1/8)); p+theme(legend.position="top")
delta_primary <- (c(1,1,1)/2^c(-1,2,4))/50
agedep_fact=1; delta_susc=sapply(1:n_age, function(x) {delta_primary/((agedep_fact^(x-1)))})
simul_length_yr=7; post_npi_yr=2
l_seas<-fun_shutdown_seasforc(npi_dates,years_pre_post_npi=c(simul_length_yr-post_npi_yr,post_npi_yr),
season_width_wks=seasforc_width_wks,init_mt_day="06-01",peak_week=c(45,49)[1],
forcing_above_baseline=1/2, npireduc_strength=0.5)
g(n_years,timesteps,simul_start_end,forcing_vector_npi) %=% l_seas
approx_seas_forc <- approxfun(data.frame(t=timesteps,seas_force=forcing_vector_npi))
approx_introd <- approxfun(data.frame(t=timesteps,as.numeric(timesteps %% 30==0)*10))
###
params<-list(list(birth_rates,matrix(unlist(lapply(uk_death_rate,function(x) rep(x,n_inf*n_compartment))))),
K_m,contmatr_rowvector,inf_vars_inds,susc_vars_inds,delta_susc)
# maternal immunity?
if (mat_imm_flag){ params[[7]] <- mat_imm_inds}
# initial conditions
initvals_sirs_model <- fcn_set_initconds(rsv_age_groups$stationary_popul,
init_set=c("previous","fromscratch")[1],init_cond_src=c("output","file")[1],
ode_solution[1:(ncol(ode_solution)-1),],init_seed=10,seed_vars="all",filename="")
# SIMULATE
tm<-proc.time();
ode_solution<-lsoda(initvals_sirs_model,timesteps,func=sirs_seasonal_forc_mat_immun,parms=params);round(proc.time()-tm,2)
df_cases_infs <- fcn_process_odesol_incid(ode_solution,n_age,n_inf,n_compartment,simul_start_end)
# simple lineplot
sel_weeks <- df_cases_infs %>% mutate(week=week(date),year=year(date)) %>% filter(week %in% c(42,52,10)) %>%
group_by(year,agegroup,week) %>% filter(date==min(date) & infection==1)
p<-fcn_plot_timecourse_by_agegr(df_cases_infs %>%
filter(t %% 7==0 & agegroup<=9 & date>as.Date("2016-10-01") & date<as.Date("2022-03-01")),
agegroup_name=rsv_age_groups$agegroup_name,sel_agelim=9,varname="value",npidates=npi_dates,date_break_val="2 month",
selweeks=sel_weeks,alphaval=0.01,vline_w=c(1/4,1/8)); p+theme(legend.position="top")
delta_primary <- (c(1,1,1)/2^c(-1,2,4))/80
agedep_fact=1; delta_susc=sapply(1:n_age, function(x) {delta_primary/((agedep_fact^(x-1)))})
simul_length_yr=7; post_npi_yr=2
l_seas<-fun_shutdown_seasforc(npi_dates,years_pre_post_npi=c(simul_length_yr-post_npi_yr,post_npi_yr),
season_width_wks=seasforc_width_wks,init_mt_day="06-01",peak_week=c(45,49)[1],
forcing_above_baseline=1/2, npireduc_strength=0.5)
g(n_years,timesteps,simul_start_end,forcing_vector_npi) %=% l_seas
approx_seas_forc <- approxfun(data.frame(t=timesteps,seas_force=forcing_vector_npi))
approx_introd <- approxfun(data.frame(t=timesteps,as.numeric(timesteps %% 30==0)*10))
###
params<-list(list(birth_rates,matrix(unlist(lapply(uk_death_rate,function(x) rep(x,n_inf*n_compartment))))),
K_m,contmatr_rowvector,inf_vars_inds,susc_vars_inds,delta_susc)
# maternal immunity?
if (mat_imm_flag){ params[[7]] <- mat_imm_inds}
# initial conditions
initvals_sirs_model <- fcn_set_initconds(rsv_age_groups$stationary_popul,
init_set=c("previous","fromscratch")[1],init_cond_src=c("output","file")[1],
ode_solution[1:(ncol(ode_solution)-1),],init_seed=10,seed_vars="all",filename="")
# SIMULATE
tm<-proc.time();
ode_solution<-lsoda(initvals_sirs_model,timesteps,func=sirs_seasonal_forc_mat_immun,parms=params);round(proc.time()-tm,2)
df_cases_infs <- fcn_process_odesol_incid(ode_solution,n_age,n_inf,n_compartment,simul_start_end)
# simple lineplot
sel_weeks <- df_cases_infs %>% mutate(week=week(date),year=year(date)) %>% filter(week %in% c(42,52,10)) %>%
group_by(year,agegroup,week) %>% filter(date==min(date) & infection==1)
p<-fcn_plot_timecourse_by_agegr(df_cases_infs %>%
filter(t %% 7==0 & agegroup<=9 & date>as.Date("2016-10-01") & date<as.Date("2022-03-01")),
agegroup_name=rsv_age_groups$agegroup_name,sel_agelim=9,varname="value",npidates=npi_dates,date_break_val="2 month",
selweeks=sel_weeks,alphaval=0.01,vline_w=c(1/4,1/8)); p+theme(legend.position="top")
View(df_cases_infs %>% filter(date>as.Date("2018-10-15") & date<as.Date("2019-03-01")) %>% group_by(agegroup,infection) %>%
summarise(cumul_inf=sum(value)) %>% mutate(agegr_prop=round(100*cumul_inf/rsv_age_groups$value[agegroup],1)))
delta_primary <- (c(1,1,1)/2^c(-1,2,4))/30
agedep_fact=1; delta_susc=sapply(1:n_age, function(x) {delta_primary/((agedep_fact^(x-1)))})
simul_length_yr=7; post_npi_yr=2
l_seas<-fun_shutdown_seasforc(npi_dates,years_pre_post_npi=c(simul_length_yr-post_npi_yr,post_npi_yr),
season_width_wks=seasforc_width_wks,init_mt_day="06-01",peak_week=c(45,49)[1],
forcing_above_baseline=1/2, npireduc_strength=0.5)
g(n_years,timesteps,simul_start_end,forcing_vector_npi) %=% l_seas
approx_seas_forc <- approxfun(data.frame(t=timesteps,seas_force=forcing_vector_npi))
approx_introd <- approxfun(data.frame(t=timesteps,as.numeric(timesteps %% 30==0)*10))
###
params<-list(list(birth_rates,matrix(unlist(lapply(uk_death_rate,function(x) rep(x,n_inf*n_compartment))))),
K_m,contmatr_rowvector,inf_vars_inds,susc_vars_inds,delta_susc)
# maternal immunity?
if (mat_imm_flag){ params[[7]] <- mat_imm_inds}
# initial conditions
initvals_sirs_model <- fcn_set_initconds(rsv_age_groups$stationary_popul,
init_set=c("previous","fromscratch")[1],init_cond_src=c("output","file")[1],
ode_solution[1:(ncol(ode_solution)-1),],init_seed=10,seed_vars="all",filename="")
# SIMULATE
tm<-proc.time();
ode_solution<-lsoda(initvals_sirs_model,timesteps,func=sirs_seasonal_forc_mat_immun,parms=params);round(proc.time()-tm,2)
df_cases_infs <- fcn_process_odesol_incid(ode_solution,n_age,n_inf,n_compartment,simul_start_end)
# simple lineplot
sel_weeks <- df_cases_infs %>% mutate(week=week(date),year=year(date)) %>% filter(week %in% c(42,52,10)) %>%
group_by(year,agegroup,week) %>% filter(date==min(date) & infection==1)
p<-fcn_plot_timecourse_by_agegr(df_cases_infs %>%
filter(t %% 7==0 & agegroup<=9 & date>as.Date("2016-10-01") & date<as.Date("2022-03-01")),
agegroup_name=rsv_age_groups$agegroup_name,sel_agelim=9,varname="value",npidates=npi_dates,date_break_val="2 month",
selweeks=sel_weeks,alphaval=0.01,vline_w=c(1/4,1/8)); p+theme(legend.position="top")
View(df_cases_infs %>% filter(date>as.Date("2018-10-15") & date<as.Date("2019-03-01")) %>% group_by(agegroup,infection) %>%
summarise(cumul_inf=sum(value)) %>% mutate(agegr_prop=round(100*cumul_inf/rsv_age_groups$value[agegroup],1)))
delta_primary <- (c(1,1,1)/2^c(-1,2,4))/35
agedep_fact=1; delta_susc=sapply(1:n_age, function(x) {delta_primary/((agedep_fact^(x-1)))})
simul_length_yr=7; post_npi_yr=2
l_seas<-fun_shutdown_seasforc(npi_dates,years_pre_post_npi=c(simul_length_yr-post_npi_yr,post_npi_yr),
season_width_wks=seasforc_width_wks,init_mt_day="06-01",peak_week=c(45,49)[1],
forcing_above_baseline=1/2, npireduc_strength=0.5)
g(n_years,timesteps,simul_start_end,forcing_vector_npi) %=% l_seas
approx_seas_forc <- approxfun(data.frame(t=timesteps,seas_force=forcing_vector_npi))
approx_introd <- approxfun(data.frame(t=timesteps,as.numeric(timesteps %% 30==0)*10))
###
params<-list(list(birth_rates,matrix(unlist(lapply(uk_death_rate,function(x) rep(x,n_inf*n_compartment))))),
K_m,contmatr_rowvector,inf_vars_inds,susc_vars_inds,delta_susc)
# maternal immunity?
if (mat_imm_flag){ params[[7]] <- mat_imm_inds}
# initial conditions
initvals_sirs_model <- fcn_set_initconds(rsv_age_groups$stationary_popul,
init_set=c("previous","fromscratch")[1],init_cond_src=c("output","file")[1],
ode_solution[1:(ncol(ode_solution)-1),],init_seed=10,seed_vars="all",filename="")
# SIMULATE
tm<-proc.time();
ode_solution<-lsoda(initvals_sirs_model,timesteps,func=sirs_seasonal_forc_mat_immun,parms=params);round(proc.time()-tm,2)
df_cases_infs <- fcn_process_odesol_incid(ode_solution,n_age,n_inf,n_compartment,simul_start_end)
# simple lineplot
sel_weeks <- df_cases_infs %>% mutate(week=week(date),year=year(date)) %>% filter(week %in% c(42,52,10)) %>%
group_by(year,agegroup,week) %>% filter(date==min(date) & infection==1)
p<-fcn_plot_timecourse_by_agegr(df_cases_infs %>%
filter(t %% 7==0 & agegroup<=9 & date>as.Date("2016-10-01") & date<as.Date("2022-03-01")),
agegroup_name=rsv_age_groups$agegroup_name,sel_agelim=9,varname="value",npidates=npi_dates,date_break_val="2 month",
selweeks=sel_weeks,alphaval=0.01,vline_w=c(1/4,1/8)); p+theme(legend.position="top")
p<-fcn_plot_timecourse_by_agegr(df_cases_infs %>%
filter(t %% 7==0 & agegroup<=9 & date>as.Date("2017-10-01") & date<as.Date("2022-03-01")),
agegroup_name=rsv_age_groups$agegroup_name,sel_agelim=9,varname="value",npidates=npi_dates,date_break_val="2 month",
selweeks=sel_weeks,alphaval=0.01,vline_w=c(1/4,1/8)); p+theme(legend.position="top")
View(df_cases_infs %>% filter(date>as.Date("2018-10-15") & date<as.Date("2019-03-01")) %>% group_by(agegroup,infection) %>%
summarise(cumul_inf=sum(value)) %>% mutate(agegr_prop=round(100*cumul_inf/rsv_age_groups$value[agegroup],1)))
delta_primary <- (c(1,1,1)/2^c(-1,2,4))/40
agedep_fact=1; delta_susc=sapply(1:n_age, function(x) {delta_primary/((agedep_fact^(x-1)))})
simul_length_yr=7; post_npi_yr=2
l_seas<-fun_shutdown_seasforc(npi_dates,years_pre_post_npi=c(simul_length_yr-post_npi_yr,post_npi_yr),
season_width_wks=seasforc_width_wks,init_mt_day="06-01",peak_week=c(45,49)[1],
forcing_above_baseline=1/2, npireduc_strength=0.5)
g(n_years,timesteps,simul_start_end,forcing_vector_npi) %=% l_seas
approx_seas_forc <- approxfun(data.frame(t=timesteps,seas_force=forcing_vector_npi))
approx_introd <- approxfun(data.frame(t=timesteps,as.numeric(timesteps %% 30==0)*10))
###
params<-list(list(birth_rates,matrix(unlist(lapply(uk_death_rate,function(x) rep(x,n_inf*n_compartment))))),
K_m,contmatr_rowvector,inf_vars_inds,susc_vars_inds,delta_susc)
# maternal immunity?
if (mat_imm_flag){ params[[7]] <- mat_imm_inds}
# initial conditions
initvals_sirs_model <- fcn_set_initconds(rsv_age_groups$stationary_popul,
init_set=c("previous","fromscratch")[1],init_cond_src=c("output","file")[1],
ode_solution[1:(ncol(ode_solution)-1),],init_seed=10,seed_vars="all",filename="")
# SIMULATE
tm<-proc.time();
ode_solution<-lsoda(initvals_sirs_model,timesteps,func=sirs_seasonal_forc_mat_immun,parms=params);round(proc.time()-tm,2)
df_cases_infs <- fcn_process_odesol_incid(ode_solution,n_age,n_inf,n_compartment,simul_start_end)
# simple lineplot
sel_weeks <- df_cases_infs %>% mutate(week=week(date),year=year(date)) %>% filter(week %in% c(42,52,10)) %>%
group_by(year,agegroup,week) %>% filter(date==min(date) & infection==1)
p<-fcn_plot_timecourse_by_agegr(df_cases_infs %>%
filter(t %% 7==0 & agegroup<=9 & date>as.Date("2017-10-01") & date<as.Date("2022-03-01")),
agegroup_name=rsv_age_groups$agegroup_name,sel_agelim=9,varname="value",npidates=npi_dates,date_break_val="2 month",
selweeks=sel_weeks,alphaval=0.01,vline_w=c(1/4,1/8)); p+theme(legend.position="top")
View(df_cases_infs %>% filter(date>as.Date("2018-10-15") & date<as.Date("2019-03-01")) %>% group_by(agegroup,infection) %>%
summarise(cumul_inf=sum(value)) %>% mutate(agegr_prop=round(100*cumul_inf/rsv_age_groups$value[agegroup],1)))
View(df_cases_infs %>% filter(date>as.Date("2018-10-15") & date<as.Date("2019-03-01")) %>% group_by(agegroup,infection) %>%
summarise(cumul_inf=sum(value)) %>% mutate(agegr_prop=round(100*cumul_inf/rsv_age_groups$value[agegroup],1)))
delta_primary <- (c(1,1,1)/2^c(-1,2,4))/45
agedep_fact=1; delta_susc=sapply(1:n_age, function(x) {delta_primary/((agedep_fact^(x-1)))})
simul_length_yr=7; post_npi_yr=2
l_seas<-fun_shutdown_seasforc(npi_dates,years_pre_post_npi=c(simul_length_yr-post_npi_yr,post_npi_yr),
season_width_wks=seasforc_width_wks,init_mt_day="06-01",peak_week=c(45,49)[1],
forcing_above_baseline=1/2, npireduc_strength=0.5)
g(n_years,timesteps,simul_start_end,forcing_vector_npi) %=% l_seas
approx_seas_forc <- approxfun(data.frame(t=timesteps,seas_force=forcing_vector_npi))
approx_introd <- approxfun(data.frame(t=timesteps,as.numeric(timesteps %% 30==0)*10))
###
params<-list(list(birth_rates,matrix(unlist(lapply(uk_death_rate,function(x) rep(x,n_inf*n_compartment))))),
K_m,contmatr_rowvector,inf_vars_inds,susc_vars_inds,delta_susc)
# maternal immunity?
if (mat_imm_flag){ params[[7]] <- mat_imm_inds}
# initial conditions
initvals_sirs_model <- fcn_set_initconds(rsv_age_groups$stationary_popul,
init_set=c("previous","fromscratch")[1],init_cond_src=c("output","file")[1],
ode_solution[1:(ncol(ode_solution)-1),],init_seed=10,seed_vars="all",filename="")
# SIMULATE
tm<-proc.time();
ode_solution<-lsoda(initvals_sirs_model,timesteps,func=sirs_seasonal_forc_mat_immun,parms=params);round(proc.time()-tm,2)
df_cases_infs <- fcn_process_odesol_incid(ode_solution,n_age,n_inf,n_compartment,simul_start_end)
# simple lineplot
sel_weeks <- df_cases_infs %>% mutate(week=week(date),year=year(date)) %>% filter(week %in% c(42,52,10)) %>%
group_by(year,agegroup,week) %>% filter(date==min(date) & infection==1)
p<-fcn_plot_timecourse_by_agegr(df_cases_infs %>%
filter(t %% 7==0 & agegroup<=9 & date>as.Date("2017-10-01") & date<as.Date("2022-03-01")),
agegroup_name=rsv_age_groups$agegroup_name,sel_agelim=9,varname="value",npidates=npi_dates,date_break_val="2 month",
selweeks=sel_weeks,alphaval=0.01,vline_w=c(1/4,1/8)); p+theme(legend.position="top")
delta_primary <- (c(1,1,1)/2^c(-1,2,4))/40
agedep_fact=1; delta_susc=sapply(1:n_age, function(x) {delta_primary/((agedep_fact^(x-1)))})
simul_length_yr=7; post_npi_yr=2
l_seas<-fun_shutdown_seasforc(npi_dates,years_pre_post_npi=c(simul_length_yr-post_npi_yr,post_npi_yr),
season_width_wks=seasforc_width_wks,init_mt_day="06-01",peak_week=c(45,49)[1],
forcing_above_baseline=1/2, npireduc_strength=0.5)
g(n_years,timesteps,simul_start_end,forcing_vector_npi) %=% l_seas
approx_seas_forc <- approxfun(data.frame(t=timesteps,seas_force=forcing_vector_npi))
approx_introd <- approxfun(data.frame(t=timesteps,as.numeric(timesteps %% 30==0)*10))
###
params<-list(list(birth_rates,matrix(unlist(lapply(uk_death_rate,function(x) rep(x,n_inf*n_compartment))))),
K_m,contmatr_rowvector,inf_vars_inds,susc_vars_inds,delta_susc)
# maternal immunity?
if (mat_imm_flag){ params[[7]] <- mat_imm_inds}
# initial conditions
initvals_sirs_model <- fcn_set_initconds(rsv_age_groups$stationary_popul,
init_set=c("previous","fromscratch")[1],init_cond_src=c("output","file")[1],
ode_solution[1:(ncol(ode_solution)-1),],init_seed=10,seed_vars="all",filename="")
# SIMULATE
tm<-proc.time();
ode_solution<-lsoda(initvals_sirs_model,timesteps,func=sirs_seasonal_forc_mat_immun,parms=params);round(proc.time()-tm,2)
df_cases_infs <- fcn_process_odesol_incid(ode_solution,n_age,n_inf,n_compartment,simul_start_end)
# simple lineplot
sel_weeks <- df_cases_infs %>% mutate(week=week(date),year=year(date)) %>% filter(week %in% c(42,52,10)) %>%
group_by(year,agegroup,week) %>% filter(date==min(date) & infection==1)
p<-fcn_plot_timecourse_by_agegr(df_cases_infs %>%
filter(t %% 7==0 & agegroup<=9 & date>as.Date("2017-10-01") & date<as.Date("2022-03-01")),
agegroup_name=rsv_age_groups$agegroup_name,sel_agelim=9,varname="value",npidates=npi_dates,date_break_val="2 month",
selweeks=sel_weeks,alphaval=0.01,vline_w=c(1/4,1/8)); p+theme(legend.position="top")
# attack rates
View(df_cases_infs %>% filter(date>as.Date("2018-10-15") & date<as.Date("2019-03-01")) %>% group_by(agegroup,infection) %>%
summarise(cumul_inf=sum(value)) %>% mutate(agegr_prop=round(100*cumul_inf/rsv_age_groups$value[agegroup],1)))
simul_length_yr=10; post_npi_yr=2
l_seas<-fun_shutdown_seasforc(npi_dates,years_pre_post_npi=c(simul_length_yr-post_npi_yr,post_npi_yr),
season_width_wks=seasforc_width_wks,init_mt_day="06-01",peak_week=c(45,49)[1],
forcing_above_baseline=1/2, npireduc_strength=0.5)
g(n_years,timesteps,simul_start_end,forcing_vector_npi) %=% l_seas
approx_seas_forc <- approxfun(data.frame(t=timesteps,seas_force=forcing_vector_npi))
approx_introd <- approxfun(data.frame(t=timesteps,as.numeric(timesteps %% 30==0)*10))
###
params<-list(list(birth_rates,matrix(unlist(lapply(uk_death_rate,function(x) rep(x,n_inf*n_compartment))))),
K_m,contmatr_rowvector,inf_vars_inds,susc_vars_inds,delta_susc)
# maternal immunity?
if (mat_imm_flag){ params[[7]] <- mat_imm_inds}
# initial conditions
initvals_sirs_model <- fcn_set_initconds(rsv_age_groups$stationary_popul,
init_set=c("previous","fromscratch")[1],init_cond_src=c("output","file")[1],
ode_solution[1:(ncol(ode_solution)-1),],init_seed=10,seed_vars="all",filename="")
# SIMULATE
tm<-proc.time();
ode_solution<-lsoda(initvals_sirs_model,timesteps,func=sirs_seasonal_forc_mat_immun,parms=params);round(proc.time()-tm,2)
df_cases_infs <- fcn_process_odesol_incid(ode_solution,n_age,n_inf,n_compartment,simul_start_end)
# simple lineplot
sel_weeks <- df_cases_infs %>% mutate(week=week(date),year=year(date)) %>% filter(week %in% c(42,52,10)) %>%
group_by(year,agegroup,week) %>% filter(date==min(date) & infection==1)
p<-fcn_plot_timecourse_by_agegr(df_cases_infs %>%
filter(t %% 7==0 & agegroup<=9 & date>as.Date("2017-10-01") & date<as.Date("2022-03-01")),
agegroup_name=rsv_age_groups$agegroup_name,sel_agelim=9,varname="value",npidates=npi_dates,date_break_val="2 month",
selweeks=sel_weeks,alphaval=0.01,vline_w=c(1/4,1/8)); p+theme(legend.position="top")
# attack rates
View(df_cases_infs %>% filter(date>as.Date("2018-10-15") & date<as.Date("2019-03-01")) %>% group_by(agegroup,infection) %>%
summarise(cumul_inf=sum(value)) %>% mutate(agegr_prop=round(100*cumul_inf/rsv_age_groups$value[agegroup],1)))
estim_attack_rates
p<-fcn_plot_timecourse_by_agegr(df_cases_infs %>%
filter(t %% 7==0 & agegroup<=9 & date>as.Date("2018-10-01") & date<as.Date("2022-03-01")),
agegroup_name=rsv_age_groups$agegroup_name,sel_agelim=9,varname="value",npidates=npi_dates,date_break_val="2 month",
selweeks=sel_weeks,alphaval=0.01,vline_w=c(1/4,1/8)); p+theme(legend.position="top")
delta_primary <- (c(1,1,1)/2^c(-1,1,3))/40
agedep_fact=1; delta_susc=sapply(1:n_age, function(x) {delta_primary/((agedep_fact^(x-1)))})
simul_length_yr=10; post_npi_yr=2
l_seas<-fun_shutdown_seasforc(npi_dates,years_pre_post_npi=c(simul_length_yr-post_npi_yr,post_npi_yr),
season_width_wks=seasforc_width_wks,init_mt_day="06-01",peak_week=c(45,49)[1],
forcing_above_baseline=1/2, npireduc_strength=0.5)
g(n_years,timesteps,simul_start_end,forcing_vector_npi) %=% l_seas
approx_seas_forc <- approxfun(data.frame(t=timesteps,seas_force=forcing_vector_npi))
approx_introd <- approxfun(data.frame(t=timesteps,as.numeric(timesteps %% 30==0)*10))
###
params<-list(list(birth_rates,matrix(unlist(lapply(uk_death_rate,function(x) rep(x,n_inf*n_compartment))))),
K_m,contmatr_rowvector,inf_vars_inds,susc_vars_inds,delta_susc)
# maternal immunity?
if (mat_imm_flag){ params[[7]] <- mat_imm_inds}
# initial conditions
initvals_sirs_model <- fcn_set_initconds(rsv_age_groups$stationary_popul,
init_set=c("previous","fromscratch")[1],init_cond_src=c("output","file")[1],
ode_solution[1:(ncol(ode_solution)-1),],init_seed=10,seed_vars="all",filename="")
# SIMULATE
tm<-proc.time();
ode_solution<-lsoda(initvals_sirs_model,timesteps,func=sirs_seasonal_forc_mat_immun,parms=params);round(proc.time()-tm,2)
df_cases_infs <- fcn_process_odesol_incid(ode_solution,n_age,n_inf,n_compartment,simul_start_end)
# simple lineplot
sel_weeks <- df_cases_infs %>% mutate(week=week(date),year=year(date)) %>% filter(week %in% c(42,52,10)) %>%
group_by(year,agegroup,week) %>% filter(date==min(date) & infection==1)
p<-fcn_plot_timecourse_by_agegr(df_cases_infs %>%
filter(t %% 7==0 & agegroup<=9 & date>as.Date("2018-10-01") & date<as.Date("2022-03-01")),
agegroup_name=rsv_age_groups$agegroup_name,sel_agelim=9,varname="value",npidates=npi_dates,date_break_val="2 month",
selweeks=sel_weeks,alphaval=0.01,vline_w=c(1/4,1/8)); p+theme(legend.position="top")
delta_primary <- (c(1,1,1)/2^c(-1,1,3))/80
agedep_fact=1; delta_susc=sapply(1:n_age, function(x) {delta_primary/((agedep_fact^(x-1)))})
simul_length_yr=10; post_npi_yr=2
l_seas<-fun_shutdown_seasforc(npi_dates,years_pre_post_npi=c(simul_length_yr-post_npi_yr,post_npi_yr),
season_width_wks=seasforc_width_wks,init_mt_day="06-01",peak_week=c(45,49)[1],
forcing_above_baseline=1/2, npireduc_strength=0.5)
g(n_years,timesteps,simul_start_end,forcing_vector_npi) %=% l_seas
approx_seas_forc <- approxfun(data.frame(t=timesteps,seas_force=forcing_vector_npi))
approx_introd <- approxfun(data.frame(t=timesteps,as.numeric(timesteps %% 30==0)*10))
###
params<-list(list(birth_rates,matrix(unlist(lapply(uk_death_rate,function(x) rep(x,n_inf*n_compartment))))),
K_m,contmatr_rowvector,inf_vars_inds,susc_vars_inds,delta_susc)
# maternal immunity?
if (mat_imm_flag){ params[[7]] <- mat_imm_inds}
# initial conditions
initvals_sirs_model <- fcn_set_initconds(rsv_age_groups$stationary_popul,
init_set=c("previous","fromscratch")[1],init_cond_src=c("output","file")[1],
ode_solution[1:(ncol(ode_solution)-1),],init_seed=10,seed_vars="all",filename="")
# SIMULATE
tm<-proc.time();
ode_solution<-lsoda(initvals_sirs_model,timesteps,func=sirs_seasonal_forc_mat_immun,parms=params);round(proc.time()-tm,2)
df_cases_infs <- fcn_process_odesol_incid(ode_solution,n_age,n_inf,n_compartment,simul_start_end)
# simple lineplot
sel_weeks <- df_cases_infs %>% mutate(week=week(date),year=year(date)) %>% filter(week %in% c(42,52,10)) %>%
group_by(year,agegroup,week) %>% filter(date==min(date) & infection==1)
p<-fcn_plot_timecourse_by_agegr(df_cases_infs %>%
filter(t %% 7==0 & agegroup<=9 & date>as.Date("2018-10-01") & date<as.Date("2022-03-01")),
agegroup_name=rsv_age_groups$agegroup_name,sel_agelim=9,varname="value",npidates=npi_dates,date_break_val="2 month",
selweeks=sel_weeks,alphaval=0.01,vline_w=c(1/4,1/8)); p+theme(legend.position="top")
delta_primary <- (c(1,1,1)/2^c(-1,1,3))/90
agedep_fact=1; delta_susc=sapply(1:n_age, function(x) {delta_primary/((agedep_fact^(x-1)))})
simul_length_yr=10; post_npi_yr=2
l_seas<-fun_shutdown_seasforc(npi_dates,years_pre_post_npi=c(simul_length_yr-post_npi_yr,post_npi_yr),
season_width_wks=seasforc_width_wks,init_mt_day="06-01",peak_week=c(45,49)[1],
forcing_above_baseline=1/2, npireduc_strength=0.5)
g(n_years,timesteps,simul_start_end,forcing_vector_npi) %=% l_seas
approx_seas_forc <- approxfun(data.frame(t=timesteps,seas_force=forcing_vector_npi))
approx_introd <- approxfun(data.frame(t=timesteps,as.numeric(timesteps %% 30==0)*10))
###
params<-list(list(birth_rates,matrix(unlist(lapply(uk_death_rate,function(x) rep(x,n_inf*n_compartment))))),
K_m,contmatr_rowvector,inf_vars_inds,susc_vars_inds,delta_susc)
# maternal immunity?
if (mat_imm_flag){ params[[7]] <- mat_imm_inds}
# initial conditions
initvals_sirs_model <- fcn_set_initconds(rsv_age_groups$stationary_popul,
init_set=c("previous","fromscratch")[1],init_cond_src=c("output","file")[1],
ode_solution[1:(ncol(ode_solution)-1),],init_seed=10,seed_vars="all",filename="")
# SIMULATE
tm<-proc.time();
ode_solution<-lsoda(initvals_sirs_model,timesteps,func=sirs_seasonal_forc_mat_immun,parms=params);round(proc.time()-tm,2)
df_cases_infs <- fcn_process_odesol_incid(ode_solution,n_age,n_inf,n_compartment,simul_start_end)
# simple lineplot
sel_weeks <- df_cases_infs %>% mutate(week=week(date),year=year(date)) %>% filter(week %in% c(42,52,10)) %>%
group_by(year,agegroup,week) %>% filter(date==min(date) & infection==1)
p<-fcn_plot_timecourse_by_agegr(df_cases_infs %>%
filter(t %% 7==0 & agegroup<=9 & date>as.Date("2018-10-01") & date<as.Date("2022-03-01")),
agegroup_name=rsv_age_groups$agegroup_name,sel_agelim=9,varname="value",npidates=npi_dates,date_break_val="2 month",
selweeks=sel_weeks,alphaval=0.01,vline_w=c(1/4,1/8)); p+theme(legend.position="top")
2^c(-1,1,3)
delta_primary <- (c(1,1,1)/2^c(-1,1,3))/70
agedep_fact=1; delta_susc=sapply(1:n_age, function(x) {delta_primary/((agedep_fact^(x-1)))})
simul_length_yr=10; post_npi_yr=2
l_seas<-fun_shutdown_seasforc(npi_dates,years_pre_post_npi=c(simul_length_yr-post_npi_yr,post_npi_yr),
season_width_wks=seasforc_width_wks,init_mt_day="06-01",peak_week=c(45,49)[1],
forcing_above_baseline=1/2, npireduc_strength=0.5)
g(n_years,timesteps,simul_start_end,forcing_vector_npi) %=% l_seas
approx_seas_forc <- approxfun(data.frame(t=timesteps,seas_force=forcing_vector_npi))
approx_introd <- approxfun(data.frame(t=timesteps,as.numeric(timesteps %% 30==0)*10))
###
params<-list(list(birth_rates,matrix(unlist(lapply(uk_death_rate,function(x) rep(x,n_inf*n_compartment))))),
K_m,contmatr_rowvector,inf_vars_inds,susc_vars_inds,delta_susc)
# maternal immunity?
if (mat_imm_flag){ params[[7]] <- mat_imm_inds}
# initial conditions
initvals_sirs_model <- fcn_set_initconds(rsv_age_groups$stationary_popul,
init_set=c("previous","fromscratch")[1],init_cond_src=c("output","file")[1],
ode_solution[1:(ncol(ode_solution)-1),],init_seed=10,seed_vars="all",filename="")
# SIMULATE
tm<-proc.time();
ode_solution<-lsoda(initvals_sirs_model,timesteps,func=sirs_seasonal_forc_mat_immun,parms=params);round(proc.time()-tm,2)
df_cases_infs <- fcn_process_odesol_incid(ode_solution,n_age,n_inf,n_compartment,simul_start_end)
# simple lineplot
sel_weeks <- df_cases_infs %>% mutate(week=week(date),year=year(date)) %>% filter(week %in% c(42,52,10)) %>%
group_by(year,agegroup,week) %>% filter(date==min(date) & infection==1)
p<-fcn_plot_timecourse_by_agegr(df_cases_infs %>%
filter(t %% 7==0 & agegroup<=9 & date>as.Date("2018-10-01") & date<as.Date("2022-03-01")),
agegroup_name=rsv_age_groups$agegroup_name,sel_agelim=9,varname="value",npidates=npi_dates,date_break_val="2 month",
selweeks=sel_weeks,alphaval=0.01,vline_w=c(1/4,1/8)); p+theme(legend.position="top")
View(df_cases_infs %>% filter(date>as.Date("2018-10-15") & date<as.Date("2019-03-01")) %>% group_by(agegroup,infection) %>%
summarise(cumul_inf=sum(value)) %>% mutate(agegr_prop=round(100*cumul_inf/rsv_age_groups$value[agegroup],1)))
