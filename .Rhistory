delta_susc
scale_f
11/R0_calc_SIRS(C_m,delta_susc_prop,rho,n_inf)
R0_calc_SIRS(C_m,delta_susc_prop,rho,n_inf)
delta_susc_prop=delta_susc*matrix(rep(rsv_age_groups$value,3),nrow=3,byrow=T)
R0_calc_SIRS(C_m,delta_susc_prop,rho,n_inf)
R0_calc_SIRS(C_m,delta_susc_prop,rho,n_inf)
scale_f=11/R0_calc_SIRS(C_m,delta_susc_prop,rho,n_inf); delta_susc_prop = delta_susc_prop*scale_f; delta_susc=delta_susc*scale_f
ptm<-proc.time(); ode_solution<-lsoda(initvals_sirs_model,timesteps,func=sirs_seasonal_forc_interpol,parms=params); proc.time()-ptm
list_simul_output=fun_process_simul_output(ode_solution,varname_list,n_age,n_inf,rsv_age_groups,neg_thresh=-0.001)
df_ode_solution=list_simul_output[[1]]; df_ode_solution_tidy=list_simul_output[[2]]; rm(list_simul_output)
ggplot(subset(df_ode_solution_tidy,grepl('I',name)&agegroup<=agegr_lim&(t_years>xval_lims[1]&t_years<xval_lims[2])),
aes_string(x="t_years",y=value_type,group="name",color="infection")) + geom_line(size=1.025) + theme_bw() + standard_theme +
theme(axis.text.x=element_text(size=8,vjust=0.5),axis.text.y=element_text(size=8),legend.position="top",legend.title=element_blank()) +
facet_wrap(as.formula(facet_formula),ncol=as.numeric(ncol_val),scales=scale_val) + scale_x_continuous(breaks=xval_breaks) +
geom_rect(aes(xmin=shutdwn_lims[1]/365,xmax=shutdwn_lims[2]/365,ymin=0,ymax=Inf),fill="pink",color=NA,alpha=0.01) +
geom_vline(data=seas_lims_plot,aes(xintercept=on),color="blue",linetype="dashed",size=0.3) +
geom_vline(data=seas_lims_plot,aes(xintercept=off),color="turquoise4",linetype="dashed",size=0.3) +
ggtitle('RSV infections by age group') + xlab('years') + ylab(y_axis_tag) + labs(caption=caption_txt)
ggplot(subset(df_ode_solution_tidy,grepl('I',name)&agegroup<=agegr_lim),
aes_string(x="t_years",y=value_type,group="name",color="infection")) + geom_line(size=1.025) + theme_bw() + standard_theme +
theme(axis.text.x=element_text(size=8,vjust=0.5),axis.text.y=element_text(size=8),legend.position="top",legend.title=element_blank()) +
facet_wrap(as.formula(facet_formula),ncol=as.numeric(ncol_val),scales=scale_val) + scale_x_continuous(breaks=xval_breaks) +
geom_rect(aes(xmin=shutdwn_lims[1]/365,xmax=shutdwn_lims[2]/365,ymin=0,ymax=Inf),fill="pink",color=NA,alpha=0.01) +
geom_vline(data=seas_lims_plot,aes(xintercept=on),color="blue",linetype="dashed",size=0.3) +
geom_vline(data=seas_lims_plot,aes(xintercept=off),color="turquoise4",linetype="dashed",size=0.3) +
ggtitle('RSV infections by age group') + xlab('years') + ylab(y_axis_tag) + labs(caption=caption_txt)
R0_calc_SIRS(C_m,delta_susc_prop,rho,n_inf)
scale_f
delta_susc*matrix(rep(rsv_age_groups$value,3),nrow=3,byrow=T)
k=8
g(scale_val,facet2tag,value_type,y_axis_tag,ncol_val,facet_formula,foldername,caption_txt,timecourse_filename) %=%
fun_tcourse_plottags(k,nval=2,rval=3,n_inf,n_age,colvar,agegr_lim,delta_susc_prop,delta_primary,
preseas_npi_on,postseas_npi_off,shutdown_scale,basal_rate)
ggplot(subset(df_ode_solution_tidy,grepl('I',name)&agegroup<=agegr_lim&(t_years>xval_lims[1]&t_years<xval_lims[2])),
aes_string(x="t_years",y=value_type,group="name",color="infection")) + geom_line(size=1.025) + theme_bw() + standard_theme +
theme(axis.text.x=element_text(size=8,vjust=0.5),axis.text.y=element_text(size=8),legend.position="top",legend.title=element_blank()) +
facet_wrap(as.formula(facet_formula),ncol=as.numeric(ncol_val),scales=scale_val) + scale_x_continuous(breaks=xval_breaks) +
geom_rect(aes(xmin=shutdwn_lims[1]/365,xmax=shutdwn_lims[2]/365,ymin=0,ymax=Inf),fill="pink",color=NA,alpha=0.01) +
geom_vline(data=seas_lims_plot,aes(xintercept=on),color="blue",linetype="dashed",size=0.3) +
geom_vline(data=seas_lims_plot,aes(xintercept=off),color="turquoise4",linetype="dashed",size=0.3) +
ggtitle('RSV infections by age group') + xlab('years') + ylab(y_axis_tag) + labs(caption=caption_txt)
scale_f
delta_susc_prop=delta_susc_prop*scale_f; delta_susc=delta_susc*scale_f
delta_susc_prop=delta_susc_prop/scale_f; delta_susc=delta_susc/scale_f
R0_calc_SIRS(C_m,delta_susc_prop,rho,n_inf)
params=list(birth_term,K_m,contmatr_rowvector,inf_vars_inds,susc_vars_inds,forcing_vector_npi,elem_time_step,delta_susc)
approx_seas_forc <- approxfun(data.frame(t=timesteps,seas_force=forcing_vector_npi))
ptm<-proc.time(); ode_solution<-lsoda(initvals_sirs_model,timesteps,func=sirs_seasonal_forc_interpol,parms=params); proc.time()-ptm
ggplot(subset(df_ode_solution_tidy,grepl('I',name)&agegroup<=agegr_lim&(t_years>xval_lims[1]&t_years<xval_lims[2])),
aes_string(x="t_years",y=value_type,group="name",color="infection")) + geom_line(size=1.025) + theme_bw() + standard_theme +
theme(axis.text.x=element_text(size=8,vjust=0.5),axis.text.y=element_text(size=8),legend.position="top",legend.title=element_blank()) +
facet_wrap(as.formula(facet_formula),ncol=as.numeric(ncol_val),scales=scale_val) + scale_x_continuous(breaks=xval_breaks) +
geom_rect(aes(xmin=shutdwn_lims[1]/365,xmax=shutdwn_lims[2]/365,ymin=0,ymax=Inf),fill="pink",color=NA,alpha=0.01) +
geom_vline(data=seas_lims_plot,aes(xintercept=on),color="blue",linetype="dashed",size=0.3) +
geom_vline(data=seas_lims_plot,aes(xintercept=off),color="turquoise4",linetype="dashed",size=0.3) +
ggtitle('RSV infections by age group') + xlab('years') + ylab(y_axis_tag) + labs(caption=caption_txt)
list_simul_output=fun_process_simul_output(ode_solution,varname_list,n_age,n_inf,rsv_age_groups,neg_thresh=-0.001)
df_ode_solution=list_simul_output[[1]]; df_ode_solution_tidy=list_simul_output[[2]]; rm(list_simul_output)
ggplot(subset(df_ode_solution_tidy,grepl('I',name)&agegroup<=agegr_lim&(t_years>xval_lims[1]&t_years<xval_lims[2])),
aes_string(x="t_years",y=value_type,group="name",color="infection")) + geom_line(size=1.025) + theme_bw() + standard_theme +
theme(axis.text.x=element_text(size=8,vjust=0.5),axis.text.y=element_text(size=8),legend.position="top",legend.title=element_blank()) +
facet_wrap(as.formula(facet_formula),ncol=as.numeric(ncol_val),scales=scale_val) + scale_x_continuous(breaks=xval_breaks) +
geom_rect(aes(xmin=shutdwn_lims[1]/365,xmax=shutdwn_lims[2]/365,ymin=0,ymax=Inf),fill="pink",color=NA,alpha=0.01) +
geom_vline(data=seas_lims_plot,aes(xintercept=on),color="blue",linetype="dashed",size=0.3) +
geom_vline(data=seas_lims_plot,aes(xintercept=off),color="turquoise4",linetype="dashed",size=0.3) +
ggtitle('RSV infections by age group') + xlab('years') + ylab(y_axis_tag) + labs(caption=caption_txt)
ggplot(subset(df_ode_solution_tidy,grepl('I',name)&agegroup<=agegr_lim ), #  & (t_years>xval_lims[1]&t_years<xval_lims[2])
aes_string(x="t_years",y=value_type,group="name",color="infection")) + geom_line(size=1.025) + theme_bw() + standard_theme +
theme(axis.text.x=element_text(size=8,vjust=0.5),axis.text.y=element_text(size=8),legend.position="top",legend.title=element_blank()) +
facet_wrap(as.formula(facet_formula),ncol=as.numeric(ncol_val),scales=scale_val) + scale_x_continuous(breaks=xval_breaks) +
geom_rect(aes(xmin=shutdwn_lims[1]/365,xmax=shutdwn_lims[2]/365,ymin=0,ymax=Inf),fill="pink",color=NA,alpha=0.01) +
geom_vline(data=seas_lims_plot,aes(xintercept=on),color="blue",linetype="dashed",size=0.3) +
geom_vline(data=seas_lims_plot,aes(xintercept=off),color="turquoise4",linetype="dashed",size=0.3) +
ggtitle('RSV infections by age group') + xlab('years') + ylab(y_axis_tag) + labs(caption=caption_txt)
xval_lims
ggplot(subset(df_ode_solution_tidy,grepl('I',name)&agegroup<=agegr_lim&(t_years>2&t_years<xval_lims[2])),
aes_string(x="t_years",y=value_type,group="name",color="infection")) + geom_line(size=1.025) + theme_bw() + standard_theme +
theme(axis.text.x=element_text(size=8,vjust=0.5),axis.text.y=element_text(size=8),legend.position="top",legend.title=element_blank()) +
facet_wrap(as.formula(facet_formula),ncol=as.numeric(ncol_val),scales=scale_val) + scale_x_continuous(breaks=xval_breaks) +
geom_rect(aes(xmin=shutdwn_lims[1]/365,xmax=shutdwn_lims[2]/365,ymin=0,ymax=Inf),fill="pink",color=NA,alpha=0.01) +
geom_vline(data=seas_lims_plot,aes(xintercept=on),color="blue",linetype="dashed",size=0.3) +
geom_vline(data=seas_lims_plot,aes(xintercept=off),color="turquoise4",linetype="dashed",size=0.3) +
ggtitle('RSV infections by age group') + xlab('years') + ylab(y_axis_tag) + labs(caption=caption_txt)
ggplot(subset(df_ode_solution_tidy,grepl('I',name)&agegroup<=agegr_lim&(t_years>2.5&t_years<xval_lims[2])),
aes_string(x="t_years",y=value_type,group="name",color="infection")) + geom_line(size=1.025) + theme_bw() + standard_theme +
theme(axis.text.x=element_text(size=8,vjust=0.5),axis.text.y=element_text(size=8),legend.position="top",legend.title=element_blank()) +
facet_wrap(as.formula(facet_formula),ncol=as.numeric(ncol_val),scales=scale_val) + scale_x_continuous(breaks=xval_breaks) +
geom_rect(aes(xmin=shutdwn_lims[1]/365,xmax=shutdwn_lims[2]/365,ymin=0,ymax=Inf),fill="pink",color=NA,alpha=0.01) +
geom_vline(data=seas_lims_plot,aes(xintercept=on),color="blue",linetype="dashed",size=0.3) +
geom_vline(data=seas_lims_plot,aes(xintercept=off),color="turquoise4",linetype="dashed",size=0.3) +
ggtitle('RSV infections by age group') + xlab('years') + ylab(y_axis_tag) + labs(caption=caption_txt)
shutdwn_lims
preseas_npi_on
postseas_npi_off
caption_txt
preseas_npi_on
source('RSV_model_functions.R')
ggplot(subset(df_ode_solution_tidy,grepl('I',name)&agegroup<=agegr_lim&(t_years>2.5&t_years<xval_lims[2])),
aes_string(x="t_years",y=value_type,group="name",color="infection")) + geom_line(size=1.025) + theme_bw() + standard_theme +
theme(axis.text.x=element_text(size=8,vjust=0.5),axis.text.y=element_text(size=8),legend.position="top",legend.title=element_blank()) +
facet_wrap(as.formula(facet_formula),ncol=as.numeric(ncol_val),scales=scale_val) + scale_x_continuous(breaks=xval_breaks) +
geom_rect(aes(xmin=shutdwn_lims[1]/365,xmax=shutdwn_lims[2]/365,ymin=0,ymax=Inf),fill="pink",color=NA,alpha=0.01) +
geom_vline(data=seas_lims_plot,aes(xintercept=on),color="blue",linetype="dashed",size=0.3) +
geom_vline(data=seas_lims_plot,aes(xintercept=off),color="turquoise4",linetype="dashed",size=0.3) +
ggtitle('RSV infections by age group') + xlab('years') + ylab(y_axis_tag) + labs(caption=caption_txt)
ggplot(subset(df_ode_solution_tidy,grepl('I',name)&agegroup<=agegr_lim&(t_years>2.5&t_years<xval_lims[2])),
aes_string(x="t_years",y=value_type,group="name",color="infection")) + geom_line(size=1.025) + theme_bw() + standard_theme +
theme(axis.text.x=element_text(size=8,vjust=0.5),axis.text.y=element_text(size=8),legend.position="top",legend.title=element_blank()) +
facet_wrap(as.formula(facet_formula),ncol=as.numeric(ncol_val),scales=scale_val) + scale_x_continuous(breaks=xval_breaks) +
geom_rect(aes(xmin=shutdwn_lims[1]/365,xmax=shutdwn_lims[2]/365,ymin=0,ymax=Inf),fill="pink",color=NA,alpha=0.01) +
geom_vline(data=seas_lims_plot,aes(xintercept=on),color="blue",linetype="dashed",size=0.3) +
geom_vline(data=seas_lims_plot,aes(xintercept=off),color="turquoise4",linetype="dashed",size=0.3) +
ggtitle('RSV infections by age group') + xlab('years') + ylab(y_axis_tag) + labs(caption=caption_txt,subtitle="susceptibility~f(age,exposure)","clinical fraction~f(age,exposure)")
caption_txt
gsub("-2","2",caption_txt)
caption_txt=gsub("-2","2",caption_txt)
g(scale_val,facet2tag,value_type,y_axis_tag,ncol_val,facet_formula,foldername,caption_txt,timecourse_filename) %=%
fun_tcourse_plottags(k,nval=2,rval=3,n_inf,n_age,colvar,agegr_lim,delta_susc_prop,delta_primary,
preseas_npi_on,postseas_npi_off,shutdown_scale,basal_rate)
caption_txt
ggplot(subset(df_ode_solution_tidy,grepl('I',name)&agegroup<=agegr_lim&(t_years>2.5&t_years<xval_lims[2])),
aes_string(x="t_years",y=value_type,group="name",color="infection")) + geom_line(size=1.025) + theme_bw() + standard_theme +
theme(axis.text.x=element_text(size=8,vjust=0.5),axis.text.y=element_text(size=8),legend.position="top",legend.title=element_blank()) +
facet_wrap(as.formula(facet_formula),ncol=as.numeric(ncol_val),scales=scale_val) + scale_x_continuous(breaks=xval_breaks) +
geom_rect(aes(xmin=shutdwn_lims[1]/365,xmax=shutdwn_lims[2]/365,ymin=0,ymax=Inf),fill="pink",color=NA,alpha=0.01) +
geom_vline(data=seas_lims_plot,aes(xintercept=on),color="blue",linetype="dashed",size=0.3) +
geom_vline(data=seas_lims_plot,aes(xintercept=off),color="turquoise4",linetype="dashed",size=0.3) +
ggtitle('RSV infections by age group') + xlab('years') + ylab(y_axis_tag) + labs(caption=caption_txt,subtitle=("susceptibility~f(age,exposure), clinical fraction~f(age,exposure)"))
timecourse_filename
plot_x_y=c(40,18); if (grepl("inf",colvar)){plot_x_y=plot_x_y[c(2,1)]*c(1.4,1)}
ggsave(timecourse_filename, width=plot_x_y[1],height=plot_x_y[2],units="cm")
fun_create_filename=function(foldername,facet2tag,value_type,n_age,scale_val,filetype){
if (nchar(facet2tag)==0) {overlay_tag='_overlaid'} else {overlay_tag=''}
if (grepl('fract',value_type)) {fract_abs="fractional"} else {fract_abs="absval"}
timecourse_filename=paste0(foldername,"/",fract_abs,'_y',scale_val,overlay_tag,".",filetype)
timecourse_filename
}
g(scale_val,facet2tag,value_type,y_axis_tag,ncol_val,facet_formula,foldername,caption_txt,timecourse_filename) %=%
fun_tcourse_plottags(k,nval=2,rval=3,n_inf,n_age,colvar,agegr_lim,delta_susc_prop,delta_primary,
preseas_npi_on,postseas_npi_off,shutdown_scale,basal_rate)
#
timecourse_filename
ggsave(timecourse_filename, width=plot_x_y[1],height=plot_x_y[2],units="cm")
k=7
g(scale_val,facet2tag,value_type,y_axis_tag,ncol_val,facet_formula,foldername,caption_txt,timecourse_filename) %=%
fun_tcourse_plottags(k,nval=2,rval=3,n_inf,n_age,colvar,agegr_lim,delta_susc_prop,delta_primary,
preseas_npi_on,postseas_npi_off,shutdown_scale,basal_rate)
ggplot(subset(df_ode_solution_tidy,grepl('I',name)&agegroup<=agegr_lim ), #  & (t_years>xval_lims[1]&t_years<xval_lims[2])
aes_string(x="t_years",y=value_type,group="name",color="infection")) + geom_line(size=1.025) + theme_bw() + standard_theme +
theme(axis.text.x=element_text(size=8,vjust=0.5),axis.text.y=element_text(size=8),legend.position="top",legend.title=element_blank()) +
facet_wrap(as.formula(facet_formula),ncol=as.numeric(ncol_val),scales=scale_val) + scale_x_continuous(breaks=xval_breaks) +
geom_rect(aes(xmin=shutdwn_lims[1]/365,xmax=shutdwn_lims[2]/365,ymin=0,ymax=Inf),fill="pink",color=NA,alpha=0.01) +
geom_vline(data=seas_lims_plot,aes(xintercept=on),color="blue",linetype="dashed",size=0.3) +
geom_vline(data=seas_lims_plot,aes(xintercept=off),color="turquoise4",linetype="dashed",size=0.3) +
ggtitle('RSV infections by age group') + xlab('years') + ylab(y_axis_tag) + labs(caption=caption_txt)
ggplot(subset(df_ode_solution_tidy,grepl('I',name)&agegroup<=agegr_lim & (t_years>xval_lims[1]&t_years<xval_lims[2])), #
aes_string(x="t_years",y=value_type,group="name",color="infection")) + geom_line(size=1.025) + theme_bw() + standard_theme +
theme(axis.text.x=element_text(size=8,vjust=0.5),axis.text.y=element_text(size=8),legend.position="top",legend.title=element_blank()) +
facet_wrap(as.formula(facet_formula),ncol=as.numeric(ncol_val),scales=scale_val) + scale_x_continuous(breaks=xval_breaks) +
geom_rect(aes(xmin=shutdwn_lims[1]/365,xmax=shutdwn_lims[2]/365,ymin=0,ymax=Inf),fill="pink",color=NA,alpha=0.01) +
geom_vline(data=seas_lims_plot,aes(xintercept=on),color="blue",linetype="dashed",size=0.3) +
geom_vline(data=seas_lims_plot,aes(xintercept=off),color="turquoise4",linetype="dashed",size=0.3) +
ggtitle('RSV infections by age group') + xlab('years') + ylab(y_axis_tag) + labs(caption=caption_txt)
npi_year=4; preseas_npi_on=4; postseas_npi_off=4 # shutdown_scale=0.2
shutdown_list=fun_shutdown_seasforc(timesteps,elem_time_step,basal_rate,npi_year,peak_week,season_width,
preseas_npi_on,postseas_npi_off,n_prec=0.01,st_devs=2:3,n_sd=2)
forcing_vector_npi=shutdown_list[[1]];shutdwn_lims=shutdown_list[[2]];seas_force=shutdown_list[[3]]; seas_lims=shutdown_list[[4]]
shutdown_scale=forcing_vector_npi[round(mean(shutdwn_lims))]
# PLOT seasonal forcing with NPI
fcn_plot_seas_forc(timesteps,seas_force,forcing_vector_npi,shutdwn_lims,subset(seas_lims,sd==2))
# SAVE
# seasfor_filename=paste0("simul_output/seas_forcing_NPI_y",npi_year,"_on",preseas_npi_on,"w_off",postseas_npi_off,"w.png")
# ggsave(seasfor_filename,units="cm",height=10,width=20)
# INITIAL CONDITIONS
# introduce stationary state as init state? # initvals_sirs_model[unlist(lapply((0:10)*9,function(x ){(4:6) + x}))]
params=list(birth_term,K_m,contmatr_rowvector,inf_vars_inds,susc_vars_inds,forcing_vector_npi,elem_time_step,delta_susc)
# solve with interpolation
approx_seas_forc <- approxfun(data.frame(t=timesteps,seas_force=forcing_vector_npi))
ptm<-proc.time(); ode_solution<-lsoda(initvals_sirs_model,timesteps,func=sirs_seasonal_forc_interpol,parms=params); proc.time()-ptm
list_simul_output=fun_process_simul_output(ode_solution,varname_list,n_age,n_inf,rsv_age_groups,neg_thresh=-0.001)
df_ode_solution=list_simul_output[[1]]; df_ode_solution_tidy=list_simul_output[[2]]; rm(list_simul_output)
xval_lims=c(3.77,max_time/365); xval_breaks=seq(0,max_time/365,by=1/4); agegr_lim=6; colvar="inf"; n_sd=2
seas_lims_plot=subset(seas_lims,sd==n_sd & on>xval_lims[1] & off<xval_lims[2])
ggplot(subset(df_ode_solution_tidy,grepl('I',name)&agegroup<=agegr_lim & (t_years>xval_lims[1]&t_years<xval_lims[2])), #
aes_string(x="t_years",y=value_type,group="name",color="infection")) + geom_line(size=1.025) + theme_bw() + standard_theme +
theme(axis.text.x=element_text(size=8,vjust=0.5),axis.text.y=element_text(size=8),legend.position="top",legend.title=element_blank()) +
facet_wrap(as.formula(facet_formula),ncol=as.numeric(ncol_val),scales=scale_val) + scale_x_continuous(breaks=xval_breaks) +
geom_rect(aes(xmin=shutdwn_lims[1]/365,xmax=shutdwn_lims[2]/365,ymin=0,ymax=Inf),fill="pink",color=NA,alpha=0.01) +
geom_vline(data=seas_lims_plot,aes(xintercept=on),color="blue",linetype="dashed",size=0.3) +
geom_vline(data=seas_lims_plot,aes(xintercept=off),color="turquoise4",linetype="dashed",size=0.3) +
ggtitle('RSV infections by age group') + xlab('years') + ylab(y_axis_tag) + labs(caption=caption_txt)
g(scale_val,facet2tag,value_type,y_axis_tag,ncol_val,facet_formula,foldername,caption_txt,timecourse_filename) %=%
fun_tcourse_plottags(k,nval=2,rval=3,n_inf,n_age,colvar,agegr_lim,delta_susc_prop,delta_primary,
preseas_npi_on,postseas_npi_off,shutdown_scale,basal_rate)
ggplot(subset(df_ode_solution_tidy,grepl('I',name)&agegroup<=agegr_lim & (t_years>xval_lims[1]&t_years<xval_lims[2])), #
aes_string(x="t_years",y=value_type,group="name",color="infection")) + geom_line(size=1.025) + theme_bw() + standard_theme +
theme(axis.text.x=element_text(size=8,vjust=0.5),axis.text.y=element_text(size=8),legend.position="top",legend.title=element_blank()) +
facet_wrap(as.formula(facet_formula),ncol=as.numeric(ncol_val),scales=scale_val) + scale_x_continuous(breaks=xval_breaks) +
geom_rect(aes(xmin=shutdwn_lims[1]/365,xmax=shutdwn_lims[2]/365,ymin=0,ymax=Inf),fill="pink",color=NA,alpha=0.01) +
geom_vline(data=seas_lims_plot,aes(xintercept=on),color="blue",linetype="dashed",size=0.3) +
geom_vline(data=seas_lims_plot,aes(xintercept=off),color="turquoise4",linetype="dashed",size=0.3) +
ggtitle('RSV infections by age group') + xlab('years') + ylab(y_axis_tag) + labs(caption=caption_txt)
plot_x_y=c(40,18); if (grepl("inf",colvar)){plot_x_y=plot_x_y[c(2,1)]*c(1.4,1)}
ggsave(timecourse_filename, width=plot_x_y[1],height=plot_x_y[2],units="cm")
shutdwn_lims[1]
shutdwn_lims[1]/365
shutdwn_lims[2]/365
k
k=8
g(scale_val,facet2tag,value_type,y_axis_tag,ncol_val,facet_formula,foldername,caption_txt,timecourse_filename) %=%
fun_tcourse_plottags(k,nval=2,rval=3,n_inf,n_age,colvar,agegr_lim,delta_susc_prop,delta_primary,
preseas_npi_on,postseas_npi_off,shutdown_scale,basal_rate)
# PLOT
ggplot(subset(df_ode_solution_tidy,grepl('I',name)&agegroup<=agegr_lim & (t_years>xval_lims[1]&t_years<xval_lims[2])), #
aes_string(x="t_years",y=value_type,group="name",color="infection")) + geom_line(size=1.025) + theme_bw() + standard_theme +
theme(axis.text.x=element_text(size=8,vjust=0.5),axis.text.y=element_text(size=8),legend.position="top",legend.title=element_blank()) +
facet_wrap(as.formula(facet_formula),ncol=as.numeric(ncol_val),scales=scale_val) + scale_x_continuous(breaks=xval_breaks) +
geom_rect(aes(xmin=shutdwn_lims[1]/365,xmax=shutdwn_lims[2]/365,ymin=0,ymax=Inf),fill="pink",color=NA,alpha=0.01) +
geom_vline(data=seas_lims_plot,aes(xintercept=on),color="blue",linetype="dashed",size=0.3) +
geom_vline(data=seas_lims_plot,aes(xintercept=off),color="turquoise4",linetype="dashed",size=0.3) +
ggtitle('RSV infections by age group') + xlab('years') + ylab(y_axis_tag) + labs(caption=caption_txt)
plot_x_y=c(40,18); if (grepl("inf",colvar)){plot_x_y=plot_x_y[c(2,1)]*c(1.4,1)}
timecourse_filename
k
k=7
g(scale_val,facet2tag,value_type,y_axis_tag,ncol_val,facet_formula,foldername,caption_txt,timecourse_filename) %=%
fun_tcourse_plottags(k,nval=2,rval=3,n_inf,n_age,colvar,agegr_lim,delta_susc_prop,delta_primary,
preseas_npi_on,postseas_npi_off,shutdown_scale,basal_rate)
# PLOT
ggplot(subset(df_ode_solution_tidy,grepl('I',name)&agegroup<=agegr_lim & (t_years>xval_lims[1]&t_years<xval_lims[2])), #
aes_string(x="t_years",y=value_type,group="name",color="infection")) + geom_line(size=1.025) + theme_bw() + standard_theme +
theme(axis.text.x=element_text(size=8,vjust=0.5),axis.text.y=element_text(size=8),legend.position="top",legend.title=element_blank()) +
facet_wrap(as.formula(facet_formula),ncol=as.numeric(ncol_val),scales=scale_val) + scale_x_continuous(breaks=xval_breaks) +
geom_rect(aes(xmin=shutdwn_lims[1]/365,xmax=shutdwn_lims[2]/365,ymin=0,ymax=Inf),fill="pink",color=NA,alpha=0.01) +
geom_vline(data=seas_lims_plot,aes(xintercept=on),color="blue",linetype="dashed",size=0.3) +
geom_vline(data=seas_lims_plot,aes(xintercept=off),color="turquoise4",linetype="dashed",size=0.3) +
ggtitle('RSV infections by age group') + xlab('years') + ylab(y_axis_tag) + labs(caption=caption_txt)
plot_x_y=c(40,18); if (grepl("inf",colvar)){plot_x_y=plot_x_y[c(2,1)]*c(1.4,1)}
ggsave(timecourse_filename, width=plot_x_y[1],height=plot_x_y[2],units="cm")
k
k=8
g(scale_val,facet2tag,value_type,y_axis_tag,ncol_val,facet_formula,foldername,caption_txt,timecourse_filename) %=%
fun_tcourse_plottags(k,nval=2,rval=3,n_inf,n_age,colvar,agegr_lim,delta_susc_prop,delta_primary,
preseas_npi_on,postseas_npi_off,shutdown_scale,basal_rate)
# PLOT
ggplot(subset(df_ode_solution_tidy,grepl('I',name)&agegroup<=agegr_lim & (t_years>xval_lims[1]&t_years<xval_lims[2])), #
aes_string(x="t_years",y=value_type,group="name",color="infection")) + geom_line(size=1.025) + theme_bw() + standard_theme +
theme(axis.text.x=element_text(size=8,vjust=0.5),axis.text.y=element_text(size=8),legend.position="top",legend.title=element_blank()) +
facet_wrap(as.formula(facet_formula),ncol=as.numeric(ncol_val),scales=scale_val) + scale_x_continuous(breaks=xval_breaks) +
geom_rect(aes(xmin=shutdwn_lims[1]/365,xmax=shutdwn_lims[2]/365,ymin=0,ymax=Inf),fill="pink",color=NA,alpha=0.01) +
geom_vline(data=seas_lims_plot,aes(xintercept=on),color="blue",linetype="dashed",size=0.3) +
geom_vline(data=seas_lims_plot,aes(xintercept=off),color="turquoise4",linetype="dashed",size=0.3) +
ggtitle('RSV infections by age group') + xlab('years') + ylab(y_axis_tag) + labs(caption=caption_txt)
## SAVE
plot_x_y=c(40,18); if (grepl("inf",colvar)){plot_x_y=plot_x_y[c(2,1)]*c(1.4,1)}
ggsave(timecourse_filename, width=plot_x_y[1],height=plot_x_y[2],units="cm")
list_symptom_agegroups=list(1:2,3:7,8:9,10:11); prop_symptom=1-c(mean(rbeta(1e3,shape1=3,shape2=30)),mean(rbeta(1e3,shape1=9,shape2=43)),
mean(rbeta(1e3,shape1=38,shape2=35)),mean(rbeta(1e3,shape1=36,shape2=11)))
# EXPOSURE DEPENDENT or not? expos_dep_val=0 -> no dependence on exposure. if expos_dep_val>0 -> dependence on expos)
df_symptom_prop=fun_propsymptom_table(list_symptom_agegroups,expos_dep_val=1,rsv_age_groups$agegroup_name,n_inf=3)
# plot (clinical fraction ~ f(age and #infection))
ggplot(df_symptom_prop,aes(x=agegroup_name,y=sympt_value*100,color=factor(n_inf),linetype=factor(n_inf),group=n_inf)) +
geom_line(size=1.25) + theme_bw() + standard_theme + labs(color="# infection",linetype="# infection") + ylab("% symptomatic")
df_ode_sol_cases_sum=fun_symptomcases_table(df_ode_solution_tidy,df_symptom_prop, bindcolnames=c("infection","agegroup"),n_sd=2)
g(scale_val,y_axis_tag,plotvar,foldername,full_filename,caption_txt) %=% fun_sumcase_plot_tags(n_val=2,r_val=2,k_plot,
df_symptom_prop,preseas_npi_on,postseas_npi_off,shutdown_scale,basal_rate)
seas_lims_plot=subset(seas_lims,sd==n_sd & on>xval_lims[1] & off<xval_lims[2])
k_plot=1
g(scale_val,y_axis_tag,plotvar,foldername,full_filename,caption_txt) %=% fun_sumcase_plot_tags(n_val=2,r_val=2,k_plot,
df_symptom_prop,preseas_npi_on,postseas_npi_off,shutdown_scale,basal_rate)
seas_lims_plot=subset(seas_lims,sd==n_sd & on>xval_lims[1] & off<xval_lims[2])
ggplot(subset(df_ode_sol_cases_sum,t_years>xval_lims[1] & t_years<(max_time/365-0.05) & agegroup<=9),
aes(x=t_years,y=get(plotvar))) + geom_line(size=1.02) + theme_bw() + standard_theme +
theme(axis.text.x=element_text(size=8,vjust=0.5),axis.text.y=element_text(size=9)) + facet_wrap(~agegroup_name,scales=scale_val,ncol=3) +
scale_x_continuous(breaks=xval_breaks,minor_breaks=seq(0,max_time/365,by=1/12)) + # scale_y_continuous(breaks=(0:10)/10) + #
geom_rect(aes(xmin=shutdwn_lims[1]/365,xmax=shutdwn_lims[2]/365,ymin=0,ymax=Inf),fill="pink",color=NA,alpha=0.01) +
geom_vline(data=seas_lims_plot,aes(xintercept=on),color="blue",linetype="dashed",size=0.3) +
geom_vline(data=seas_lims_plot,aes(xintercept=off),color="turquoise4",linetype="dashed",size=0.3) +
xlab('years') + ylab(y_axis_tag) + ggtitle('Symptomatic cases by age group') + theme(legend.position='none') +
labs(caption=caption_txt) # subtitle=paste0("NPI during year ",npi_year)
full_filename
ggsave(full_filename,width=31,height=22,units="cm")
ggsave(full_filename,width=31,height=22,units="cm")
ggsave(full_filename,width=31,height=22,units="cm")
k_plot
k_plot=2
g(scale_val,y_axis_tag,plotvar,foldername,full_filename,caption_txt) %=% fun_sumcase_plot_tags(n_val=2,r_val=2,k_plot,
df_symptom_prop,preseas_npi_on,postseas_npi_off,shutdown_scale,basal_rate)
seas_lims_plot=subset(seas_lims,sd==n_sd & on>xval_lims[1] & off<xval_lims[2])
ggplot(subset(df_ode_sol_cases_sum,t_years>xval_lims[1] & t_years<(max_time/365-0.05) & agegroup<=9),
aes(x=t_years,y=get(plotvar))) + geom_line(size=1.02) + theme_bw() + standard_theme +
theme(axis.text.x=element_text(size=8,vjust=0.5),axis.text.y=element_text(size=9)) + facet_wrap(~agegroup_name,scales=scale_val,ncol=3) +
scale_x_continuous(breaks=xval_breaks,minor_breaks=seq(0,max_time/365,by=1/12)) + # scale_y_continuous(breaks=(0:10)/10) + #
geom_rect(aes(xmin=shutdwn_lims[1]/365,xmax=shutdwn_lims[2]/365,ymin=0,ymax=Inf),fill="pink",color=NA,alpha=0.01) +
geom_vline(data=seas_lims_plot,aes(xintercept=on),color="blue",linetype="dashed",size=0.3) +
geom_vline(data=seas_lims_plot,aes(xintercept=off),color="turquoise4",linetype="dashed",size=0.3) +
xlab('years') + ylab(y_axis_tag) + ggtitle('Symptomatic cases by age group') + theme(legend.position='none') +
labs(caption=caption_txt) # subtitle=paste0("NPI during year ",npi_year)
ggsave(full_filename,width=31,height=22,units="cm")
season_peaks_AUC=fcn_seas_agedistrib(df_ode_sol_cases_sum,max_time,timesteps,seas_case_threshold=5e2)
plot_season_agedist=subset(season_peaks_AUC, agegroup<=7 & season>=min(3,npi_year-1))
selvar="auc_case_share_season"; ylimvals=c(min(plot_season_agedist[,selvar]),max(plot_season_agedist[,selvar]))
ggplot(plot_season_agedist,aes(x=agegroup_name,y=get(selvar),group=season)) +
geom_line(aes(linetype=pre_post_shtdn,color=factor(season),size=pre_post_shtdn)) +
geom_point(aes(shape=pre_post_shtdn,color=factor(season)),size=3) + theme_bw() + standard_theme +
theme(axis.text=element_text(size=12),legend.text=element_text(size=12),legend.title=element_text(size=14)) +
xlab("") + ylab("fraction of all symptomatic cases in season") + # facet_wrap(~season,ncol=3) +
scale_linetype_manual(values=c("solid","dotdash","dashed"))+scale_shape_manual(values=c(0,2,1)) +
scale_size_manual(values=c(1.75,1.25,1.25)) +
scale_y_continuous(breaks=seq(round(ylimvals[1],2),round(ylimvals[2],2),by=0.02),limits=ylimvals) +
labs(size="pre/post-NPI",shape="pre/post-NPI",color="season",linetype="pre/post-NPI",title="Age distribution before and after NPI in year 5",
caption=paste0('NPI (-',preseas_npi_on,',',postseas_npi_off,") weeks from CI95 season, ",basal_rate*1e2,"% off-season activity"))
ggplot(plot_season_agedist,aes(x=agegroup_name,y=get(selvar),group=season)) + geom_bar()
ggplot(plot_season_agedist,aes(x=agegroup_name,y=get(selvar),group=season)) + geom_bar(stat = "")
ggplot(plot_season_agedist,aes(x=agegroup_name,y=get(selvar),group=season)) + geom_bar(stat = "identity")
ggplot(plot_season_agedist,aes(x=agegroup_name,y=get(selvar),group=season)) + geom_bar(stat = "identity",fill=factor(season))
ggplot(plot_season_agedist,aes(x=agegroup_name,y=get(selvar),group=season)) + geom_bar(aes(fill=factor(season)),stat="identity")
ggplot(plot_season_agedist,aes(x=agegroup_name,y=get(selvar),group=season)) +
geom_bar(aes(fill=factor(season)),stat="identity",position="dodge")
ggplot(plot_season_agedist,aes(x=agegroup_name,y=get(selvar),group=season)) +
geom_bar(aes(fill=factor(season),color=pre_post_shtdn),stat="identity",position="dodge")
ggplot(plot_season_agedist,aes(x=agegroup_name,y=get(selvar),group=season)) +
geom_bar(aes(color=factor(season),fill=pre_post_shtdn),stat="identity",position="dodge")
ggplot(plot_season_agedist,aes(x=agegroup_name,y=get(selvar),group=season)) +
geom_bar(aes(fill=pre_post_shtdn),stat="identity",position="dodge")
ggplot(plot_season_agedist,aes(x=agegroup_name,y=get(selvar),group=season)) +
geom_bar(aes(fill=pre_post_shtdn),color="black",stat="identity",position="dodge")
ggplot(plot_season_agedist,aes(x=agegroup_name,y=get(selvar),group=season)) +
geom_bar(aes(fill=pre_post_shtdn),color="black",stat="identity",position="dodge") + theme_bw() + standard_theme +
theme(axis.text=element_text(size=12),legend.text=element_text(size=12),legend.title=element_text(size=14)) +
xlab("") + ylab("fraction of all symptomatic cases in season") + # facet_wrap(~season,ncol=3)
ggplot(plot_season_agedist,aes(x=agegroup_name,y=get(selvar),group=season)) +
geom_bar(aes(fill=pre_post_shtdn),color="black",stat="identity",position="dodge") + theme_bw() + standard_theme +
theme(axis.text=element_text(size=12),legend.text=element_text(size=12),legend.title=element_text(size=14)) +
xlab("") + ylab("fraction of all symptomatic cases in season") #
ggplot(plot_season_agedist,aes(x=agegroup_name,y=get(selvar),group=season)) +
geom_bar(aes(fill=pre_post_shtdn),color="black",stat="identity",position="dodge") + theme_bw() + standard_theme +
theme(axis.text=element_text(size=12),legend.text=element_text(size=12),legend.title=element_text(size=14)) +
xlab("") + ylab("fraction of all symptomatic cases in season") +
labs(size="pre/post-NPI",shape="pre/post-NPI",color="season",linetype="pre/post-NPI",
title="Age distribution before and after NPI in year 5",
caption=paste0('NPI (-',preseas_npi_on,',',postseas_npi_off,") weeks from CI95 season, ",basal_rate*1e2,"% off-season activity"))
ggplot(plot_season_agedist,aes(x=agegroup_name,y=get(selvar),group=season)) +
geom_bar(aes(fill=pre_post_shtdn),color="black",stat="identity",position="dodge") + theme_bw() + standard_theme +
theme(axis.text=element_text(size=12),legend.text=element_text(size=12),legend.title=element_text(size=14)) +
xlab("") + ylab("fraction of all symptomatic cases in season") +
labs(size="pre/post-NPI",shape="pre/post-NPI",color="season",linetype="pre/post-NPI",title="Age distribution before and after NPI",
caption=paste0('NPI (-',preseas_npi_on,',',postseas_npi_off,") weeks from CI95 season, ",basal_rate*1e2,"% off-season activity"))
ggplot(plot_season_agedist,aes(x=agegroup_name,y=get(selvar),group=season)) +
geom_bar(aes(fill=pre_post_shtdn),color="black",stat="identity",position="dodge") + theme_bw() + standard_theme +
theme(axis.text=element_text(size=12),legend.text=element_text(size=12),legend.title=element_text(size=14)) +
xlab("") + ylab("fraction of all symptomatic cases in season") +
labs(size="pre/post-NPI",shape="pre/post-NPI",color="season",linetype="pre/post-NPI",title="Age distribution before and after NPI",
caption=paste0('NPI (-',preseas_npi_on,',',postseas_npi_off,") weeks from CI95 season, ",basal_rate*1e2,"% off-season activity")) +
coord_flip() # coord_cartesian(ylim=c(0.2,meanage_max-0.2)) +
ggplot(plot_season_agedist,aes(x=agegroup_name,y=get(selvar),group=season)) +
geom_bar(aes(fill=pre_post_shtdn),color="black",stat="identity",position="dodge") + theme_bw() + standard_theme +
theme(axis.text=element_text(size=12),legend.text=element_text(size=12),legend.title=element_text(size=14)) +
xlab("") + ylab("fraction of all symptomatic cases in season") +
labs(size="pre/post-NPI",shape="pre/post-NPI",color="season",linetype="pre/post-NPI",title="Age distribution before and after NPI",
caption=paste0('NPI (-',preseas_npi_on,',',postseas_npi_off,") weeks from CI95 season, ",basal_rate*1e2,"% off-season activity")) +
coord_flip() + coord_cartesian(ylim=c(0,0.45))
ggplot(plot_season_agedist,aes(x=agegroup_name,y=get(selvar),group=season)) +
geom_bar(aes(fill=pre_post_shtdn),color="black",stat="identity",position="dodge") + theme_bw() + standard_theme +
theme(axis.text=element_text(size=12),legend.text=element_text(size=12),legend.title=element_text(size=14)) +
xlab("") + ylab("fraction of all symptomatic cases in season") +
labs(size="pre/post-NPI",shape="pre/post-NPI",color="season",linetype="pre/post-NPI",title="Age distribution before and after NPI",
caption=paste0('NPI (-',preseas_npi_on,',',postseas_npi_off,") weeks from CI95 season, ",basal_rate*1e2,"% off-season activity")) +
coord_cartesian(ylim=c(0,0.45)) + coord_flip()
standard_theme
ggplot(plot_season_agedist,aes(x=agegroup_name,y=get(selvar),group=season)) +
geom_bar(aes(fill=pre_post_shtdn),color="black",stat="identity",position="dodge") + theme_bw() + standard_theme +
theme(axis.text=element_text(size=12),legend.text=element_text(size=12),legend.title=element_text(size=14),axis.text.y=element_text(angle=90)) +
xlab("") + ylab("fraction of all symptomatic cases in season") +
labs(size="pre/post-NPI",shape="pre/post-NPI",color="season",linetype="pre/post-NPI",title="Age distribution before and after NPI",
caption=paste0('NPI (-',preseas_npi_on,',',postseas_npi_off,") weeks from CI95 season, ",basal_rate*1e2,"% off-season activity")) +
coord_cartesian(ylim=c(0,0.45)) + coord_flip()
ggplot(plot_season_agedist,aes(x=agegroup_name,y=get(selvar),group=season)) +
geom_bar(aes(fill=pre_post_shtdn),color="black",stat="identity",position="dodge") + theme_bw() + standard_theme +
theme(axis.text=element_text(size=12),legend.text=element_text(size=12),legend.title=element_text(size=14),
axis.text.x=element_text(angle=90)) + xlab("") + ylab("fraction of all symptomatic cases in season") +
labs(size="pre/post-NPI",shape="pre/post-NPI",color="season",linetype="pre/post-NPI",title="Age distribution before and after NPI",
caption=paste0('NPI (-',preseas_npi_on,',',postseas_npi_off,") weeks from CI95 season, ",basal_rate*1e2,"% off-season activity")) +
coord_cartesian(ylim=c(0,0.45)) + coord_flip()
ggplot(plot_season_agedist,aes(x=agegroup_name,y=get(selvar),group=season)) +
geom_bar(aes(fill=pre_post_shtdn),color="black",stat="identity",position="dodge") + theme_bw() + standard_theme +
theme(axis.text=element_text(size=12),legend.text=element_text(size=12),legend.title=element_text(size=14),
axis.text.x=element_text(angle=0)) + xlab("") + ylab("fraction of all symptomatic cases in season") +
labs(size="pre/post-NPI",shape="pre/post-NPI",color="season",linetype="pre/post-NPI",title="Age distribution before and after NPI",
caption=paste0('NPI (-',preseas_npi_on,',',postseas_npi_off,") weeks from CI95 season, ",basal_rate*1e2,"% off-season activity")) +
coord_cartesian(ylim=c(0,0.45)) + coord_flip()
ggplot(plot_season_agedist,aes(x=agegroup_name,y=get(selvar),group=season)) +
geom_bar(aes(fill=pre_post_shtdn),color="black",stat="identity",position="dodge") + theme_bw() + standard_theme +
theme(axis.text=element_text(size=12),legend.text=element_text(size=12),legend.title=element_text(size=14),
axis.text.x=element_text(angle=0)) + xlab("") + ylab("fraction of all symptomatic cases in season") +
labs(size="pre/post-NPI",shape="pre/post-NPI",color="season",linetype="pre/post-NPI",title="Age distribution before and after NPI",
subtitle=paste0('NPI (-',preseas_npi_on,',',postseas_npi_off,") weeks from CI95 season, ",basal_rate*1e2,"% off-season activity")) +
coord_cartesian(ylim=c(0,0.45)) + coord_flip()
agedistr_filename=fcn_agedistrib_plot_tags(delta_susc_prop,delta_primary,plot_season_agedist,df_symptom_prop,
preseas_npi_on,postseas_npi_off,seas_case_threshold=5e3)
agedistr_filename
ggsave(agedistr_filename,width=32,height=22,units="cm")
ggplot(plot_season_agedist,aes(x=agegroup_name,y=get(selvar)*100,group=season)) +
geom_bar(aes(fill=pre_post_shtdn),color="black",stat="identity",position="dodge") + theme_bw() + standard_theme +
theme(axis.text=element_text(size=12),legend.text=element_text(size=12),legend.title=element_text(size=14),
axis.text.x=element_text(angle=0)) + xlab("") + ylab("% symptomatic cases in season") +
labs(size="pre/post-NPI",shape="pre/post-NPI",color="season",linetype="pre/post-NPI",title="Age distribution before and after NPI",
subtitle=paste0('NPI (-',preseas_npi_on,',',postseas_npi_off,") weeks from CI95 season, ",basal_rate*1e2,"% off-season activity")) +
coord_cartesian(ylim=c(0,0.45)) + coord_flip()
ggplot(plot_season_agedist,aes(x=agegroup_name,y=get(selvar)*100,group=season)) +
geom_bar(aes(fill=pre_post_shtdn),color="black",stat="identity",position="dodge") + theme_bw() + standard_theme +
theme(axis.text=element_text(size=12),legend.text=element_text(size=12),legend.title=element_text(size=14),
axis.text.x=element_text(angle=0)) + xlab("") + ylab("% symptomatic cases in season") +
labs(size="pre/post-NPI",shape="pre/post-NPI",color="season",linetype="pre/post-NPI",title="Age distribution before and after NPI",
subtitle=paste0('NPI (-',preseas_npi_on,',',postseas_npi_off,") weeks from CI95 season, ",basal_rate*1e2,"% off-season activity")) +
coord_cartesian(ylim=c(0,45)) + coord_flip()
ggsave(agedistr_filename,width=32,height=22,units="cm")
(0:10)*5
ggplot(plot_season_agedist,aes(x=agegroup_name,y=get(selvar)*100,group=season)) +
geom_bar(aes(fill=pre_post_shtdn),color="black",stat="identity",position="dodge") + theme_bw() + standard_theme +
theme(axis.text=element_text(size=12),legend.text=element_text(size=12),legend.title=element_text(size=14),
axis.text.x=element_text(angle=0)) + xlab("") + ylab("% symptomatic cases in season") +
labs(size="pre/post-NPI",shape="pre/post-NPI",color="season",linetype="pre/post-NPI",title="Age distribution before and after NPI",
subtitle=paste0('NPI (-',preseas_npi_on,',',postseas_npi_off,") weeks from CI95 season, ",basal_rate*1e2,"% off-season activity")) +
scale_y_continuous(breaks=(0:10)*5) + coord_flip() # coord_cartesian(ylim=c(0,45)) +
ggsave(agedistr_filename,width=32,height=22,units="cm")
agedistr_filename
# symptomcases_sever_ageexpdep sever_ageexpdep
fcn_agedistrib_plot_tags <- function(delta_susc_prop,delta_primary,plot_season_peaks,df_symptom_prop,
preseas_npi_on,postseas_npi_on,seas_case_threshold){
if (length(unique(round(array(delta_susc_prop),5)))==length(delta_primary)){foldername="suscept_noagedep"} else {
foldername="suscept_agedep"}
symptvals=length(unique(df_symptom_prop[,c("sympt_value")])); symptagegrval=length(unique(df_symptom_prop[,c("sympt_group")]))
if (symptvals>symptagegrval){dep_tag="_ageexpdep"}else{dep_tag="_agedep_only"}
agedistr_filename=paste0("simul_output/",foldername,"/symptomcases_sever",dep_tag,"/age_distrib_npi_on",preseas_npi_on,"w_off",
postseas_npi_on,"w_basal",1e2*basal_rate,"pct.png") # _seasmincase,seas_case_threshold/1e3,"e3
#,"_seas", paste0(unique(plot_season_peaks$season),collapse="_")
agedistr_filename
}
fcn_agedistrib_plot_tags(delta_susc_prop,delta_primary,plot_season_agedist,df_symptom_prop,
preseas_npi_on,postseas_npi_off,seas_case_threshold=5e3)
agedistr_filename=fcn_agedistrib_plot_tags(delta_susc_prop,delta_primary,plot_season_agedist,df_symptom_prop,
preseas_npi_on,postseas_npi_off,seas_case_threshold=5e3)
ggsave(agedistr_filename,width=32,height=22,units="cm")
View(season_peaks_AUC)
ggplot(plot_season_agedist,aes(x=agegroup_name,y=max_case,group=season)) +
geom_bar(aes(fill=pre_post_shtdn),color="black",stat="identity",position="dodge") + theme_bw() + standard_theme +
theme(axis.text=element_text(size=12),legend.text=element_text(size=12),legend.title=element_text(size=14),
axis.text.x=element_text(angle=0)) + xlab("") + ylab("% symptomatic cases in season") +
labs(size="pre/post-NPI",shape="pre/post-NPI",color="season",linetype="pre/post-NPI",title="Age distribution before and after NPI",
subtitle=paste0('NPI (-',preseas_npi_on,',',postseas_npi_off,") weeks from CI95 season, ",basal_rate*1e2,"% off-season activity")) +
coord_flip()
season_peaks_AUC %>% pivot_longer(cols=!c(agegroup,agegroup_name,agegr_size,mean_age))
season_peaks_AUC %>% pivot_longer(cols=!c(agegroup,agegroup_name,season,agegr_size,mean_age))
season_peaks_AUC %>% pivot_longer(cols=!c(agegroup,agegroup_name,season,agegr_size,mean_age,pre_post_shtdn))
season_peaks_AUC=fcn_seas_agedistrib(df_ode_sol_cases_sum,max_time,timesteps,seas_case_threshold=5e2) %>%
pivot_longer(cols=!c(agegroup,agegroup_name,season,agegr_size,mean_age,pre_post_shtdn))
season_peaks_AUC
ggplot(subset(season_peaks_AUC, agegroup<=7 & season>=min(3,npi_year-1) & name %in% "auc_case_share_season"),
aes(x=agegroup_name,y=value,group=season)) +
geom_bar(aes(fill=pre_post_shtdn),color="black",stat="identity",position="dodge") + theme_bw() + standard_theme +
theme(axis.text=element_text(size=12),legend.text=element_text(size=12),legend.title=element_text(size=14),
axis.text.x=element_text(angle=0)) + xlab("") + ylab("% symptomatic cases in season") +
labs(size="pre/post-NPI",shape="pre/post-NPI",color="season",linetype="pre/post-NPI",title="Age distribution before and after NPI",
subtitle=paste0('NPI (-',preseas_npi_on,',',postseas_npi_off,") weeks from CI95 season, ",basal_rate*1e2,"% off-season activity"))
ggplot(subset(season_peaks_AUC, agegroup<=7 & season>=min(3,npi_year-1)),
aes(x=agegroup_name,y=value,group=season)) + geom_bar(aes(fill=pre_post_shtdn),color="black",stat="identity",position="dodge") +
facet_wrap(~name) +
theme_bw()+standard_theme + theme(axis.text=element_text(size=12),legend.text=element_text(size=12),legend.title=element_text(size=14),
axis.text.x=element_text(angle=0)) + xlab("") + ylab("% symptomatic cases in season") +
labs(size="pre/post-NPI",shape="pre/post-NPI",color="season",linetype="pre/post-NPI",title="Age distribution before and after NPI",
subtitle=paste0('NPI (-',preseas_npi_on,',',postseas_npi_off,") weeks from CI95 season, ",basal_rate*1e2,"% off-season activity"))
ggplot(subset(season_peaks_AUC, agegroup<=7 & season>=min(3,npi_year-1)),
aes(x=agegroup_name,y=value,group=season)) + geom_bar(aes(fill=pre_post_shtdn),color="black",stat="identity",position="dodge") +
facet_wrap(~name,scales="free") +
theme_bw()+standard_theme + theme(axis.text=element_text(size=12),legend.text=element_text(size=12),legend.title=element_text(size=14),
axis.text.x=element_text(angle=0)) + xlab("") + ylab("% symptomatic cases in season") +
labs(size="pre/post-NPI",shape="pre/post-NPI",color="season",linetype="pre/post-NPI",title="Age distribution before and after NPI",
subtitle=paste0('NPI (-',preseas_npi_on,',',postseas_npi_off,") weeks from CI95 season, ",basal_rate*1e2,"% off-season activity"))
npi_year
ggplot(subset(season_peaks_AUC, agegroup<=7 & season>=min(3,npi_year)),
aes(x=agegroup_name,y=value,group=season)) + geom_bar(aes(fill=pre_post_shtdn),color="black",stat="identity",position="dodge") +
facet_wrap(~name,scales="free") +
theme_bw()+standard_theme + theme(axis.text=element_text(size=12),legend.text=element_text(size=12),legend.title=element_text(size=14),
axis.text.x=element_text(angle=0)) + xlab("") + ylab("% symptomatic cases in season") +
labs(size="pre/post-NPI",shape="pre/post-NPI",color="season",linetype="pre/post-NPI",title="Age distribution before and after NPI",
subtitle=paste0('NPI (-',preseas_npi_on,',',postseas_npi_off,") weeks from CI95 season, ",basal_rate*1e2,"% off-season activity"))
ggplot(subset(season_peaks_AUC, agegroup<=7 & season>npi_year),
aes(x=agegroup_name,y=value,group=season)) + geom_bar(aes(fill=pre_post_shtdn),color="black",stat="identity",position="dodge") +
facet_wrap(~name,scales="free") +
theme_bw()+standard_theme + theme(axis.text=element_text(size=12),legend.text=element_text(size=12),legend.title=element_text(size=14),
axis.text.x=element_text(angle=0)) + xlab("") + ylab("% symptomatic cases in season") +
labs(size="pre/post-NPI",shape="pre/post-NPI",color="season",linetype="pre/post-NPI",title="Age distribution before and after NPI",
subtitle=paste0('NPI (-',preseas_npi_on,',',postseas_npi_off,") weeks from CI95 season, ",basal_rate*1e2,"% off-season activity"))
ggplot(subset(season_peaks_AUC, agegroup<=7 & season>npi_year),
aes(x=agegroup_name,y=value,group=season)) + geom_bar(aes(fill=pre_post_shtdn),color="black",stat="identity",position="dodge") +
facet_wrap(~name,scales="free") +
theme_bw()+standard_theme + theme(axis.text=element_text(size=12),legend.text=element_text(size=12),legend.title=element_text(size=14),
axis.text.x=element_text(angle=0)) + xlab("") + ylab("% symptomatic cases in season") +
labs(size="pre/post-NPI",shape="pre/post-NPI",color="season",linetype="pre/post-NPI",title="Age distribution before and after NPI",
subtitle=paste0('NPI (-',preseas_npi_on,',',postseas_npi_off,") weeks from CI95 season, ",basal_rate*1e2,"% off-season activity")) +
coord_flip()
ggplot(subset(season_peaks_AUC, agegroup<=7 & season>npi_year),
aes(x=agegroup_name,y=value,group=season)) + geom_bar(aes(fill=pre_post_shtdn),color="black",stat="identity",position="dodge") +
facet_wrap(~name,scales="free") +
theme_bw()+standard_theme + theme(axis.text=element_text(size=12),legend.text=element_text(size=12),legend.title=element_text(size=14),
axis.text.x=element_text(angle=0)) + xlab("") + ylab("% symptomatic cases in season") +
labs(size="pre/post-NPI",shape="pre/post-NPI",color="season",linetype="pre/post-NPI",title="Age distribution before and after NPI",
subtitle=paste0('NPI (',preseas_npi_on,',',postseas_npi_off,") weeks from CI95 season, ",basal_rate*1e2,"% off-season activity")) +
coord_flip()
subset(season_peaks_AUC,name %in% "max_case" & season %in% c(5,6,7))
